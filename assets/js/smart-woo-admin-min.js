function renderTable(e,t,a,n,s,c){let o={},r=document.querySelector(".sw-admin-dash-body"),l=document.querySelector(".sw-search-container");smartwooRemoveTable(),addPaginationControls(l,n,s,totalItems=t.length,c);let i=document.createElement("table");i.classList.add("sw-table");let d=document.createElement("thead"),p=document.createElement("tr"),h=document.createElement("th"),u=document.createElement("input");u.type="checkbox",u.addEventListener("change",function(){v.querySelectorAll('input[type="checkbox"]').forEach(e=>{e.checked=this.checked,o[e.name]=this.checked}),y()}),h.appendChild(u),p.appendChild(h),e.forEach(e=>{let t=document.createElement("th");t.textContent=e,p.appendChild(t)}),d.appendChild(p),i.appendChild(d);let v=document.createElement("tbody");if(0===t.length){let f=document.createElement("tr"),m=document.createElement("td");m.colSpan=e.length+1,m.textContent="No service found.",m.classList.add("sw-not-found"),f.appendChild(m),v.appendChild(f)}else t.forEach((e,t)=>{let n=document.createElement("tr"),s=document.createElement("td"),c=document.createElement("input");c.type="checkbox",c.name=a[t],o[c.name]&&(c.checked=!0),c.addEventListener("change",function(){o[this.name]=this.checked,this.checked||(u.checked=!1);Array.from(v.querySelectorAll('input[type="checkbox"]')).every(e=>e.checked)&&(u.checked=!0),y()}),s.appendChild(c),n.appendChild(s),e.forEach((e,t)=>{let a=document.createElement("td");a.textContent=e,1===t&&(a.classList.add("service-id-column"),a.style.cursor="pointer",a.addEventListener("click",function(){smartwoo_service_admin_view(e)})),n.appendChild(a)}),v.appendChild(n)});function y(){let e=[];if(v.querySelectorAll('input[type="checkbox"]:checked').forEach(t=>e.push(t.name)),e.length>0)smartwooShowActionDialog(e);else{let t=document.querySelector(".sw-action-container");t&&t.remove()}}i.appendChild(v),r.appendChild(i),addPaginationControls(r,n,s,totalItems,c)}function addPaginationControls(e,t,a,n,s){let c=document.createElement("div");c.classList.add("sw-pagination-buttons"),c.style.float="right";let o=document.createElement("p");if(o.textContent=`${n} items`,c.appendChild(o),a>1){let r=a-1,l=document.createElement("a");l.classList.add("sw-pagination-button");let i=document.createElement("button");i.innerHTML='<span class="dashicons dashicons-arrow-left-alt2"></span>',l.appendChild(i),l.addEventListener("click",function(e){e.preventDefault(),fetchDashboardData(s,{paged:r})}),c.appendChild(l)}let d=document.createElement("p");if(d.textContent=`${a} of ${t}`,c.appendChild(d),a<t){let p=a+1,h=document.createElement("a");h.classList.add("sw-pagination-button");let u=document.createElement("button");u.innerHTML='<span class="dashicons dashicons-arrow-right-alt2"></span>',h.appendChild(u),h.addEventListener("click",function(e){e.preventDefault(),fetchDashboardData(s,{paged:p})}),c.appendChild(h)}e.appendChild(c)}function smartwoo_service_admin_view(e){let t=new URL(smartwoo_admin_vars.sw_admin_page);t.searchParams.set("action","view-service"),t.searchParams.set("service_id",e),t.searchParams.set("tab","details"),window.location.href=t.href}function smartwooRemoveTable(){let e=document.querySelector(".sw-table"),t=document.querySelectorAll(".sw-pagination-buttons");e&&(jQuery(".sw-table").fadeOut(),setTimeout(()=>{e.remove()},1e3),t&&t.forEach(e=>{e.remove()}))}function smartwooPostBulkAction(e,t=[]){if("delete"!==e||confirm("Heads up!! You are about to delete the selected service"+(t.length>1?"s":"")+". click ok to continue."))showLoadingIndicator(),jQuery.ajax({type:"POST",url:smartwoo_admin_vars.ajax_url,data:{action:"smartwoo_dashboard_bulk_action",service_ids:t,real_action:e,security:smartwoo_admin_vars.security},success:function(e){e.success?(showNotification(e.data.message),setTimeout(()=>{window.location.reload()},2e3)):showNotification("Oops! "+e.data.message)},error:function(e,t,a){console.error("Bulk action failed:",a),showNotification("An error occured, please inspect console.")},complete:function(){let e=document.querySelector(".sw-action-container");e&&e.remove(),hideLoadingIndicator()}})}function smartwooShowActionDialog(e){let t=document.querySelector(".sw-action-container");t&&t.remove();let a=document.createElement("div");a.classList.add("sw-action-container"),a.innerHTML=`
      <select id="sw-action-select" name="dash_bulk_action">
        <option selected>Choose Action</option>
        <option value="auto_calc">Auto Calculate</option>
        <option value="Active">Activate</option>
        <option value="Active (NR)">Disable Renewal</option>
        <option value="Suspended">Suspend Service</option>
        <option value="Cancelled">Cancel Service</option>
        <option value="Due for Renewal">Due for Renewal</option>
        <option value="Expired">Expired</option>
        <option value="delete">Delete</option>
      </select>
      <input type="hidden" name="service_ids" value="${e}"/>
    `;let n=document.querySelector(".sw-table");n.prepend(a),jQuery(".sw-action-container").fadeIn().css("display","flex"),a.addEventListener("change",()=>{let t=a.querySelector("select").value,n=document.querySelector(".sw-action-btn");n&&n.remove();let s=document.createElement("button");s.classList.add("sw-action-btn"),s.textContent="Apply Action",s.style.backgroundColor="#f1f1f1f1",s.style.marginLeft="-2px",s.style.height="30px",s.style.border="solid .5px blue","Choose Action"!==t&&(a.append(s),jQuery(s).fadeIn()),s&&s.addEventListener("click",()=>{smartwooPostBulkAction(t,e)})})}let fetchIntervals={};function fetchServiceCount(e,t,a){let n=document.querySelectorAll(".sw-dash-content");return jQuery.ajax({type:"GET",url:smartwoo_admin_vars.ajax_url,data:{action:"smartwoo_dashboard",real_action:t,security:smartwoo_admin_vars.security},success:function(s){if(s.success){smartwoo_clear_dash_content(e);let c=document.createElement("div"),o=document.createElement("h2"),r=document.createElement("span");c.classList.add("sw-dash-count"),o.textContent=s.data[t],r.textContent=a,c.appendChild(o),c.appendChild(r),n[e].append(c),jQuery(".sw-dash-count").fadeIn().css("display","flex")}else console.log(s),smartwooAddRetryBtn(e,t,a)},error:function(n){let s="Error fetching data: ";n.responseJSON&&n.responseJSON.data&&n.responseJSON.data.message?s+=n.responseJSON.data.message:n.responseText?s+=n.responseText:s+=n,console.error(s),smartwooAddRetryBtn(e,t,a)},complete:function(){fetchIntervals[e]&&clearInterval(fetchIntervals[e]),fetchIntervals[e]=setInterval(()=>{fetchServiceCount(e,t,a),console.log("Auto data refresh executed for index: "+e)},3e5)}})}function smartwooAddRetryBtn(e,t,a){let n=document.querySelectorAll(".sw-dash-content");smartwoo_clear_dash_content(e);let s=document.createElement("div");s.classList.add("sw-dash-count");let c=document.createElement("h3");c.textContent="Error Occurred",s.append(c);let o=document.createElement("button");o.classList.add("sw-red-button"),o.textContent="retry",o.setAttribute("onclick",`fetchServiceCount(${e}, '${t}', '${a}')`),s.append(o),n[e].append(s),jQuery(".sw-dash-count").fadeIn().css("display","flex"),o.addEventListener("click",()=>{o.style.cursor="progress"})}function smartwoo_clear_dash_content(e){let t=document.querySelectorAll(".sw-dash-content");t&&(t[e].innerHTML="")}function fetchDashboardData(e,t={}){let a=document.querySelector(".sw-dash-content-container");switch(showLoadingIndicator(),e){case 0:realAction="all_services_table";break;case 1:realAction="all_pending_services_table";break;case 2:realAction="all_active_services_table";break;case 3:realAction="all_active_nr_services_table";break;case 4:realAction="all_due_services_table";break;case 5:realAction="all_on_grace_services_table";break;case 6:realAction="all_expired_services_table";break;case 7:realAction="all_cancelled_services_table";break;case 8:realAction="all_suspended_services_table";break;default:realAction="sw_search"}if("all_pending_services_table"===realAction){window.location.href=smartwoo_admin_vars.admin_order_page;return}let n=t.limit||10,s=t.paged||1;jQuery.ajax({type:"GET",url:smartwoo_admin_vars.ajax_url,data:{action:"smartwoo_dashboard",security:smartwoo_admin_vars.security,real_action:realAction,limit:n,paged:s,search_term:"sw_search"===realAction?t.search:""},success:function(t){if(t.success){let a=t.data.all_services_table,n=a.table_header,s=a.table_body,c=a.row_names,o;renderTable(n,s,c,a.total_pages,a.current_page,e)}},error:function(e){var t="Error fetching data: ";e.responseJSON&&e.responseJSON.data&&e.responseJSON.data.message?t+=e.responseJSON.data.message:e.responseText?t+=e.responseText:t+=e,console.error(t)},complete:function(){a&&(a.style.display="none"),hideLoadingIndicator()}})}document.addEventListener("DOMContentLoaded",()=>{let e=document.querySelector(".sw-dash-content-container"),t=document.querySelectorAll(".sw-dash-content"),a=document.getElementById("dashOrderBtn"),n=document.getElementById("dashAddNew"),s=document.getElementById("dashInvoicesBtn"),c=document.getElementById("dashProductBtn"),o=document.getElementById("dashSettingsBtn"),r=document.querySelector(".sw-upgrade-to-pro"),l=document.getElementById("sw_service_search"),i=document.getElementById("swSearchBtn"),d=document.getElementById("search-notification"),p=document.querySelector(".sw-admin-menu-icon");if(e){for(let h=0;h<8;h++)e.append(t[0].cloneNode(!0));let u=[fetchServiceCount(0,"total_services","All Services"),fetchServiceCount(1,"total_pending_services","Pending Service Orders"),fetchServiceCount(2,"total_active_services","Active Services"),fetchServiceCount(3,"total_active_nr_services","Active No Renewal"),fetchServiceCount(4,"total_due_services","Due for Renewal"),fetchServiceCount(5,"total_on_grace_services","Grace Period"),fetchServiceCount(6,"total_expired_services","Expired Services"),fetchServiceCount(7,"total_cancelled_services","Cancelled Services"),fetchServiceCount(8,"total_suspended_services","Suspended Services")];Promise.allSettled(u).finally(()=>{document.dispatchEvent(new CustomEvent("SmartWooDashboardLoaded"))})}if(n&&n.addEventListener("click",()=>{window.location.href=smartwoo_admin_vars.new_service_page}),a&&a.addEventListener("click",()=>{window.location.href=smartwoo_admin_vars.admin_order_page}),s&&s.addEventListener("click",()=>{window.location.href=smartwoo_admin_vars.admin_invoice_page}),c&&c.addEventListener("click",()=>{window.location.href=smartwoo_admin_vars.sw_product_page}),o&&o.addEventListener("click",()=>{window.location.href=smartwoo_admin_vars.sw_options_page}),r&&r.addEventListener("click",()=>{window.open(smartwoo_admin_vars.smartwoo_plugin_page,"_blank")}),l&&i&&d&&(l.addEventListener("input",()=>{let e=l.value.trim();0==e.length?i.style.cursor="not-allowed":(i.style.cursor="pointer",d.style.display="none")}),i.addEventListener("click",()=>{let e=l.value.trim();e.length>0?(fetchDashboardData("sw_search",{search:e}),d.style.display="none"):(d.textContent="Search field cannot be empty.",d.style.display="block"),d.addEventListener("click",()=>{d.style.display="none"})})),p){let v=!1;p.addEventListener("click",()=>{let e=document.querySelector(".sw-admin-dash-nav");v?jQuery(e).fadeIn().css("display","none"):jQuery(e).fadeIn().css("display","flex"),v=!v})}}),document.addEventListener("SmartWooDashboardLoaded",()=>{let e=document.querySelectorAll(".sw-dash-content"),t=document.getElementById("dashboardBtn"),a=document.querySelector(".sw-dash-content-container");e.forEach((e,t)=>{e.addEventListener("click",e=>{!e.target.matches(".sw-red-button")&&(smartwooRemoveTable(),fetchDashboardData(t))})}),t.addEventListener("click",()=>{smartwooRemoveTable(),jQuery(a).fadeIn().css("display","flex")})});