function renderTable(e,t,a,r,n,s){let o={},l=document.querySelector(".sw-admin-dash-body"),i=document.querySelector(".sw-search-container");smartwooRemoveTable(),addPaginationControls(i,r,n,totalItems=t.length,s);let c=document.createElement("table");c.classList.add("sw-table");let d=document.createElement("thead"),u=document.createElement("tr"),m=document.createElement("th"),p=document.createElement("input");p.type="checkbox",p.addEventListener("change",function(){v.querySelectorAll('input[type="checkbox"]').forEach(e=>{e.checked=this.checked,o[e.name]=this.checked}),f()}),m.appendChild(p),u.appendChild(m),e.forEach(e=>{let t=document.createElement("th");t.textContent=e,u.appendChild(t)}),d.appendChild(u),c.appendChild(d);let v=document.createElement("tbody");if(0===t.length){let h=document.createElement("tr"),y=document.createElement("td");y.colSpan=e.length+1,y.textContent="No service found.",y.classList.add("sw-not-found"),h.appendChild(y),v.appendChild(h)}else t.forEach((e,t)=>{let r=document.createElement("tr"),n=document.createElement("td"),s=document.createElement("input");s.type="checkbox",s.name=a[t],o[s.name]&&(s.checked=!0),s.addEventListener("change",function(){o[this.name]=this.checked,this.checked||(p.checked=!1);Array.from(v.querySelectorAll('input[type="checkbox"]')).every(e=>e.checked)&&(p.checked=!0),f()}),n.appendChild(s),r.appendChild(n),e.forEach((e,t)=>{let a=document.createElement("td");a.textContent=e,1===t&&(a.classList.add("service-id-column"),a.style.cursor="pointer",a.setAttribute("title","View service details"),a.addEventListener("click",function(){smartwoo_service_admin_view(e)})),r.appendChild(a)}),v.appendChild(r)});function f(){let e=[];if(v.querySelectorAll('input[type="checkbox"]:checked').forEach(t=>e.push(t.name)),e.length>0)smartwooShowActionDialog(e);else{let t=document.querySelector(".sw-action-container");t&&t.remove()}}c.appendChild(v),c.style.display="none",l.appendChild(c),jQuery(c).fadeIn("slow"),addPaginationControls(l,r,n,totalItems,s)}let addedClearBtn=!1;function addPaginationControls(e,t,a,r,n){let s=document.createElement("div");s.classList.add("sw-pagination-buttons"),s.style.float="right";let o=document.createElement("p");if(o.textContent=`${r} items`,s.appendChild(o),a>1){let l=a-1,i=document.createElement("a");i.classList.add("sw-pagination-button");let c=document.createElement("button");c.innerHTML='<span class="dashicons dashicons-arrow-left-alt2"></span>',i.appendChild(c),i.addEventListener("click",function(e){e.preventDefault(),fetchDashboardData(n,{paged:l,limit:25})}),s.appendChild(i)}let d=document.createElement("p");if(d.textContent=`${a} of ${t}`,s.appendChild(d),a<t){let u=a+1,m=document.createElement("a");m.classList.add("sw-pagination-button");let p=document.createElement("button");p.innerHTML='<span class="dashicons dashicons-arrow-right-alt2"></span>',m.appendChild(p),m.addEventListener("click",function(e){e.preventDefault(),fetchDashboardData(n,{paged:u,limit:25})}),s.appendChild(m)}if(e.appendChild(s),!addedClearBtn){s.style.float="",s.style.marginTop="0px";let v=document.createElement("span");v.classList.add("dashicons","dashicons-dismiss"),v.style.color="#c48f00",v.style.marginRight="20px",v.style.fontSize="23px",v.style.cursor="pointer",v.setAttribute("title","Restore dashboard"),e.appendChild(v),addedClearBtn=!0;let h=()=>{let e=document.getElementById("dashboardBtn");addedClearBtn=!1,v.remove(),e.click()};document.addEventListener("dashboardtableRemoved",()=>{v.remove(),addedClearBtn=!1}),v.addEventListener("click",h)}}function smartwoo_service_admin_view(e){let t=new URL(smartwoo_admin_vars.sw_admin_page);t.searchParams.set("tab","view-service"),t.searchParams.set("service_id",e),window.location.href=t.href}function smartwooRemoveTable(){let e=document.querySelector(".sw-table"),t=document.querySelectorAll(".sw-pagination-buttons");e&&(e.remove(),t&&t.forEach(e=>{e.remove()}),document.dispatchEvent(new CustomEvent("dashboardtableRemoved")))}function smartwooPostBulkAction(e,t=[]){if("delete"!==e||confirm("Warning: You are about to delete the selected service"+(t.length>1?"s":"")+", along with all related invoices and assets. Click OK to confirm."))showLoadingIndicator(),jQuery.ajax({type:"POST",url:smartwoo_admin_vars.ajax_url,data:{action:"smartwoo_dashboard_bulk_action",service_ids:t,real_action:e,security:smartwoo_admin_vars.security},success:function(e){e.success?(showNotification(e.data.message),setTimeout(()=>{window.location.reload()},2e3)):showNotification("Oops! "+e.data.message)},error:function(e,t,a){console.error("Bulk action failed:",a),showNotification("An error occured, please inspect console.")},complete:function(){let e=document.querySelector(".sw-action-container");e&&e.remove(),hideLoadingIndicator()}})}function smartwooShowActionDialog(e){let t=document.querySelector(".sw-action-container");t&&t.remove();let a=document.createElement("div");a.classList.add("sw-action-container"),a.innerHTML=`
      <select id="sw-action-select" name="dash_bulk_action">
        <option selected>Choose Action</option>
        <option value="auto_calc">Auto Calculate</option>
        <option value="Active">Activate</option>
        <option value="Active (NR)">Disable Renewal</option>
        <option value="Suspended">Suspend Service</option>
        <option value="Cancelled">Cancel Service</option>
        <option value="Due for Renewal">Due for Renewal</option>
        <option value="Expired">Expired</option>
        <option value="delete">Delete</option>
      </select>
      <input type="hidden" name="service_ids" value="${e}"/>
    `;let r=document.querySelector(".sw-table");r.prepend(a),jQuery(".sw-action-container").fadeIn().css("display","flex"),a.addEventListener("change",()=>{let t=a.querySelector("select").value,r=document.querySelector(".sw-action-btn");r&&r.remove();let n=document.createElement("button");n.classList.add("sw-action-btn"),n.textContent="Apply Action","Choose Action"!==t&&(a.append(n),jQuery(n).fadeIn()),n&&n.addEventListener("click",()=>{smartwooPostBulkAction(t,e)})})}let fetchIntervals={};function fetchServiceCount(e,t,a){let r=document.querySelectorAll(".sw-dash-content");return jQuery.ajax({type:"GET",url:smartwoo_admin_vars.ajax_url,data:{action:"smartwoo_dashboard",real_action:t,security:smartwoo_admin_vars.security},success:function(n){if(n.success){smartwoo_clear_dash_content(e);let s=document.createElement("div"),o=document.createElement("h2"),l=document.createElement("span");s.classList.add("sw-dash-count"),o.textContent=n.data[t],l.textContent=a,s.appendChild(o),s.appendChild(l),r[e].append(s),jQuery(".sw-dash-count").fadeIn().css("display","flex")}else smartwooAddRetryBtn(e,t,a)},error:function(r){let n="Error fetching data: ";r.responseJSON&&r.responseJSON.data&&r.responseJSON.data.message?n+=r.responseJSON.data.message:r.responseText?n+=r.responseText:n+=r,console.error(n),smartwooAddRetryBtn(e,t,a)},complete:function(){fetchIntervals[e]&&clearInterval(fetchIntervals[e]),fetchIntervals[e]=setInterval(()=>{fetchServiceCount(e,t,a)},9e5)}})}function smartwooAddRetryBtn(e,t,a){let r=document.querySelectorAll(".sw-dash-content");smartwoo_clear_dash_content(e);let n=document.createElement("div");n.classList.add("sw-dash-count");let s=document.createElement("h3");s.textContent="Error Occurred",n.append(s);let o=document.createElement("button");o.classList.add("sw-red-button"),o.textContent="retry",o.setAttribute("onclick",`fetchServiceCount(${e}, '${t}', '${a}')`),n.append(o),r[e].append(n),jQuery(".sw-dash-count").fadeIn().css("display","flex"),o.addEventListener("click",()=>{o.style.cursor="progress"})}function smartwoo_clear_dash_content(e){let t=document.querySelectorAll(".sw-dash-content");t&&(t[e].innerHTML="")}function fetchDashboardData(e,t={}){let a=document.querySelector(".sw-dash-content-container"),r=smartWooAddSpinner("swloader",!0);switch(e){case 0:realAction="all_services_table";break;case 1:realAction="all_pending_services_table";break;case 2:realAction="all_active_services_table";break;case 3:realAction="all_active_nr_services_table";break;case 4:realAction="all_due_services_table";break;case 5:realAction="all_on_grace_services_table";break;case 6:realAction="all_expired_services_table";break;case 7:realAction="all_cancelled_services_table";break;case 8:realAction="all_suspended_services_table";break;default:realAction="sw_search"}if("all_pending_services_table"===realAction){window.location.href=smartwoo_admin_vars.admin_order_page;return}let n=t.limit||10,s=t.paged||1,o=new URL(smartwoo_admin_vars.ajax_url);o.searchParams.set("action","smartwoo_dashboard"),o.searchParams.set("security",smartwoo_admin_vars.security),o.searchParams.set("real_action",realAction),o.searchParams.set("limit",n),o.searchParams.set("paged",s),"sw_search"===realAction&&o.searchParams.set("search_term",t.search),fetch(o).then(e=>{if(e.ok)return e.json()}).then(t=>{if(t.success){let a=t.data.all_services_table,r=a.table_header,n=a.table_body,s=a.row_names,o;renderTable(r,n,s,a.total_pages,a.current_page,e)}}).catch(e=>{var t="Error fetching data: ";e.responseJSON&&e.responseJSON.data&&e.responseJSON.data.message?t+=e.responseJSON.data.message:e.responseText?t+=e.responseText:t+=e,console.error(t)}).finally(()=>{a&&(a.style.display="none"),smartWooRemoveSpinner(r)})}function smartwooDeleteInvoice(e){confirm("Do you realy want to delete this invoice? This action cannot be reversed!")&&(spinner=smartWooAddSpinner("swloader",!0),jQuery.ajax({type:"POST",url:smart_woo_vars.ajax_url,data:{action:"delete_invoice",invoice_id:e,security:smart_woo_vars.security},success:function(e){e.success?(alert(e.data.message),window.location.href=smart_woo_vars.admin_invoice_page):alert(e.data.message)},error:function(e){console.error("Error deleting invoice:",e)},complete:function(){smartWooRemoveSpinner(spinner)}}))}function smartwooProBntAction(e){let t=document.querySelector(".sw-pro-sell-content");t.innerHTML="";let a=document.createElement("span");a.className="dashicons dashicons-yes-alt";let r=document.createElement("h2");r.textContent="dismiss_fornow"===e?"Dismissed.":"Reminder has been set.",t.append(a),t.append(r),setInterval(()=>a.classList.toggle("loaded"),500),setTimeout(()=>{jQuery(t.parentElement).fadeOut(()=>t.remove())},2e3);let n=new URL(smart_woo_vars.ajax_url);n.searchParams.set("action","smartwoo_pro_button_action"),n.searchParams.set("security",smart_woo_vars.security),n.searchParams.set("real_action",e),fetch(n).then(e=>{if(!e.ok)throw Error(e.text());return e.json()}).then(e=>{e.success||window.location.reload()}).catch(e=>{showNotification("Error occured"),window.location.reload()})}function smartwooDeleteProduct(e){confirm("Are you sure you want to permanently delete this product? This action cannot be reversed!")&&(spinner=smartWooAddSpinner("swloader",!0),jQuery.ajax({type:"POST",url:smart_woo_vars.ajax_url,data:{action:"smartwoo_delete_product",product_id:e,security:smart_woo_vars.security},success:function(e){e.success?(alert(e.data.message),window.location.href=smart_woo_vars.sw_product_page):alert(e.data.message)},error:function(e){console.error("Error deleting product:",e)},complete:function(){smartWooRemoveSpinner(spinner)}}))}function smartwooDeleteService(e){confirm("Are you sure you want to delete this service? All invoices and assets alocated to it will be lost forever.")&&(spinner=smartWooAddSpinner("sw-admin-spinner",!0),jQuery.ajax({type:"POST",url:smart_woo_vars.ajax_url,data:{action:"smartwoo_delete_service",service_id:e,security:smart_woo_vars.security},success:function(e){e.success?(alert(e.data.message),window.location.href=smart_woo_vars.sw_admin_page):alert(e.data.message)},error:function(e){alert("Error deleting service:",e)},complete:function(){smartWooRemoveSpinner(spinner)}}))}function smartwoo_pro_ad(e,t){let a=document.querySelector(".sw-pro-div");a&&jQuery(a).fadeOut("fast",()=>{a.remove()});let r=document.querySelector(".smartwoo-settings-form")??document.querySelector("#pro-target"),n=document.createElement("div");n.classList.add("sw-pro-div");let s=document.createElement("span");s.classList.add("dashicons","dashicons-dismiss"),s.setAttribute("title","close"),s.style.position="absolute",s.style.right="5px",s.style.top="2px",s.style.color="red",s.style.cursor="pointer";let o=document.createElement("h2");o.textContent=e;let l=document.createElement("div");l.classList.add("sw-pro-body"),l.innerHTML=t;let i=document.createElement("span");i.classList.add("sw-pro-action-btn"),i.textContent="Activate Pro Feature",n.append(o),n.append(s),n.append(l),n.append(i),r.prepend(n),jQuery(n).fadeIn("slow").css("display","flex"),s.addEventListener("click",()=>{jQuery(n).fadeOut("fast",()=>{n.remove()})}),i.addEventListener("click",()=>{window.open(smartwoo_admin_vars.smartwoo_pro_page,"_blank")})}async function smartwooPromptGuestInvoiceData(e){return new Promise(t=>{let a={first_name:"",last_name:"",billing_email:"",billing_company:"",billing_phone:"",billing_address:""},r=document.createElement("div"),n=`<span class="smartwoo-remove dashicons dashicons-no" title="Close"></span>
            <h2>${e}</h2>
            <div class="sw-guest-name-row">
                <input type="text" name="first_name" placeholder="First Name" id="first_name"/>
                <input type="text" name="last_name" placeholder="Last Name" id="last_name"/>
            </div>
            <div class="sw-guest-other-row">
                <input type="text" name="billing_email" placeholder="Billing Email" id="billing_email"/>
                <input type="text" name="billing_company" placeholder="Billing Company" id="billing_company"/>
                <input type="text" name="billing_phone" placeholder="Billing Phone" id="billing_phone">
                <input type="text" name="billing_address" placeholder="Full address" id="billing_address"/>
                <button class="sw-blue-button" style="width: 80%; margin: 10px;">Add Guest</button>

            </div>
        `;r.classList.add("sw-guest-invoice-container"),r.innerHTML=n;let s=document.querySelector("#smartwooInvoiceForm").parentElement,o=document.querySelector("#smartwooInvoiceForm");s.insertBefore(r,o);r.querySelector(".smartwoo-remove").addEventListener("click",()=>{r.remove(),t(!1)});r.querySelector(".sw-blue-button").addEventListener("click",e=>{e.preventDefault(),a.first_name=r.querySelector('input[name="first_name"]').value,a.last_name=r.querySelector('input[name="last_name"]').value,a.billing_address=r.querySelector('input[name="billing_address"]').value,a.billing_phone=r.querySelector('input[name="billing_phone"]').value,a.billing_company=r.querySelector('input[name="billing_company"]').value,a.billing_email=r.querySelector('input[name="billing_email"]').value,t(a),r.remove()})})}function smartwooPostswTableBulkAction(e={hook_name:"",value:""},t=[]){if("delete"===e.value&&!confirm(`You are about to delete the selected item${t.length>1?"s":""}! click ok to confirm.`))return;let a=smartWooAddSpinner("swloader",!0);(url=new URL(smartwoo_admin_vars.ajax_url)).searchParams.append("action","smartwoo_table_bulk_action");let r=new FormData;r.append("payload",t),r.append("security",smartwoo_admin_vars.security),r.append("real_action",e.hook_name),r.append("selected_action",e.value),fetch(url,{method:"POST",body:r}).then(e=>{if(!e.ok)throw showNotification(`An error occured: [${e.statusText}]`,6e3),Error("Network response was not ok");return e.json()}).then(e=>{e.success?(showNotification(e.data.message,3e3),setTimeout(()=>{window.location.reload()},3e3)):showNotification(e.data.message,6e3)}).catch(e=>{console.error("Error:",e)}).finally(()=>{smartWooRemoveSpinner(a)})}function smartwooBulkActionForTable(e={options:[],selectedRows:[],hookName}){let t=document.querySelector(".sw-action-container"),a=document.querySelector(".sw-table");t&&t.remove();let r=document.createElement("div");r.classList.add("sw-action-container");let n=document.createElement("select");n.id="sw-action-select",n.name="dash_bulk_action",n.innerHTML='<option value="">Choose Action</option>',e.options.forEach(e=>{(optElement=document.createElement("option")).value=e.value,optElement.text=e.text,n.appendChild(optElement)});let s=e.selectedRows,o=document.createElement("button");o.classList.add("sw-action-btn"),o.textContent="Apply Action",r.append(n),a.prepend(r),jQuery(r).fadeIn().css("display","flex"),n.addEventListener("change",()=>{n.value?(r.append(o),jQuery(o).fadeIn()):o.remove()}),o.addEventListener("click",()=>{smartwooPostswTableBulkAction({hook_name:e.hookName,value:n.value},s)})}function smartwooopenWPMediaOnClick(e){e.preventDefault();let t=e.target.parentElement,a=t.querySelector("[smartwoo-media-id]"),r=t.querySelector("[smartwoo-media-url]"),n;if(n){n.open();return}(n=wp.media({title:"Select File",button:{text:"Insert"},multiple:!1})).on("select",()=>{let e=n.state().get("selection").first().toJSON();a&&(a.value="",a.value=e.id),r&&(r.value="",r.value=e.url)}),n.open()}function smartwooDatesInputsHandler(){let e=e=>{var t,a=e.getFullYear();return`${a}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`},t=document.querySelector("#sw_start_date"),a=document.querySelector("#sw_next_payment_date"),r=document.querySelector("#sw_end_date"),n=document.querySelector("#sw_billing_cycle");n&&t&&a&&r&&n.addEventListener("change",()=>{if(t.value.length){if(!n.value)return}else{t.reportValidity(),n.value="";return}let s=new Date(t.value);if(isNaN(s.getTime())){showNotification("Invalid start date",3e3);return}let o=new Date(s),l;switch(n.value){case"Weekly":o.setDate(o.getDate()+7);break;case"Monthly":o.setMonth(o.getMonth()+1);break;case"Quarterly":o.setMonth(o.getMonth()+3);break;case"Semiannually":o.setMonth(o.getMonth()+6);break;case"Yearly":o.setFullYear(o.getFullYear()+1);break;default:showNotification("Invalid billing cycle",3e3);return}let i=smart_woo_vars.global_nextpay_date||{operator:"-",number:7,unit:"days"},c=i.operator||"-",d=parseInt(i.number)||7,u=i.unit||"days";switch(l=new Date(o),u){case"days":l.setDate(l.getDate()+("-"===c?-d:d));break;case"weeks":l.setDate(l.getDate()+("-"===c?-(7*d):7*d));break;case"months":l.setMonth(l.getMonth()+("-"===c?-d:d));break;case"years":l.setFullYear(l.getFullYear()+("-"===c?-d:d));break;default:console.error("Unsupported time unit:",u)}r.value=e(o),a.value=e(l),r.dispatchEvent(new Event("input",{bubbles:!0})),a.dispatchEvent(new Event("input",{bubbles:!0}))});let s=document.querySelectorAll("#sw_start_date, #sw_next_payment_date, #sw_end_date, #date_on_sale_from, #date_on_sale_to, #invoice_due_date, #smartwoo_update_creation_date");s.length&&s.forEach(e=>{let t={dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,showButtonPanel:!0,closeText:"Done",currentText:"Today",nextText:"Next",prevText:"Previous",onSelect:function(){e.dispatchEvent(new Event("input",{bubbles:!0}))}};"Invoices"===smart_woo_vars.currentScreen&&jQuery(e).on("focus",function(){requestAnimationFrame(()=>{let e=jQuery(this),t=e.offset(),a=e.outerHeight();jQuery("#ui-datepicker-div").css({top:t.top+a+"px",left:t.left+"px","z-index":9999})})}),e.getAttribute("smartwoo-datetime-picker")?jQuery(e).datetimepicker({...t,timeFormat:"HH:mm:ss"}):jQuery(e).datepicker(t)})}function smartwooInvoiceEditorItemCalculator(e){let t=document.getElementById("product_dropdown_json"),a=document.querySelector("#swInvoiceItemsBody"),r=document.querySelector("input#subtotal-value"),n=document.querySelector("input#grandTotal"),s=document.querySelector("#smartwoo-no-pro-add-item-btn");if(!t){console.warn("Product JSON data element not found.");return}let o=t.getAttribute("data-json"),l=JSON.parse(o),i=0,c=!1,d=()=>{let e=a.querySelectorAll("tr"),t=0;e.forEach(e=>{let a=e.querySelector("input.sw-invoice-editor-quantity-input"),r=e.querySelector("input.sw-invoice-editor-unit-price-input"),n=e.querySelector(".sw-invoice-editor-line-total-input");if(a&&r&&n){let s=parseFloat(a.value)||0,o=parseFloat(r.value)||0,l=s*o;n.textContent=l.toFixed(2),t+=l}}),r&&(r.value=t.toFixed(2)),n&&(n.value=t.toFixed(2))},u=()=>{a.innerHTML="",c=!1},m=t=>{t.preventDefault(),t.target.removeEventListener("click",m),jQuery(t.target.closest("tr")).fadeOut("fast",()=>{t.target.closest("tr").remove(),i++,0===a.querySelectorAll("tr").length&&(e.value="",a.innerHTML='<tr><td colspan="4" class="sw-not-found">No items</td></tr>',c=!1),d()})},p=e=>{u();let t=e.target.value;if(l[t]){let r=l[t],n=`
			<tr>
				<td><input type="text" class="sw-invoice-editor-item-name-input" value="${r.name}" id="${t}" autocomplete="off"></td>
				<td><input type="number" class="sw-invoice-editor-quantity-input" value="1" step="1" min="1" disabled></td>
				<td><input type="number" class="sw-invoice-editor-unit-price-input" value="${r.price}" step="0.01" disabled></td>
				<td class="sw-invoice-editor-line-total-input">${parseFloat(r.price).toFixed(2)}</td>
				<td><span class="dashicons dashicons-trash sw-remove" title="Remove item" style="cursor: pointer; color: red;"></span></td>
			</tr>
			${r.sign_up_fee?`
			<tr>
				<td><input type="text" class="sw-invoice-editor-item-name-input" value="Sign-up Fee" id="${String(Math.random()).replace("0.","")}" autocomplete="off"></td>
				<td><input type="number" class="sw-invoice-editor-quantity-input" value="1" step="1" min="1" disabled></td>
				<td><input type="number" name="fee" class="sw-invoice-editor-unit-price-input" value="${r.sign_up_fee}" step="0.01"></td>
				<td class="sw-invoice-editor-line-total-input">${parseFloat(r.sign_up_fee).toFixed(2)}</td>
				<td><span class="dashicons dashicons-trash sw-remove" title="Remove item" style="cursor: pointer; color: red;"></span></td>
			</tr>`:""}
			`;a.innerHTML=n,a.querySelectorAll(".sw-remove").forEach(e=>{e.addEventListener("click",m)}),a.querySelectorAll("input.sw-invoice-editor-quantity-input, input.sw-invoice-editor-unit-price-input").forEach(e=>{e.addEventListener("input",d)}),c=!0,d()}};s&&s.addEventListener("click",e=>{e.preventDefault(),smartwoo_pro_ad("Add Custom Items","Add unlimited items to your invoice, track payment logs, make quotes with Smart Woo Pro")}),a.querySelectorAll("input.sw-invoice-editor-quantity-input, input.sw-invoice-editor-unit-price-input").forEach(e=>{e.addEventListener("input",d)}),a.querySelectorAll(".sw-remove").forEach(e=>{e.addEventListener("click",m)}),d(),e.addEventListener("change",p)}document.addEventListener("DOMContentLoaded",()=>{smartwooDatesInputsHandler();let e=document.querySelector(".sw-dash-content-container"),t=document.querySelectorAll(".sw-dash-content"),a=document.getElementById("dashOrderBtn"),r=document.getElementById("dashAddNew"),n=document.getElementById("dashInvoicesBtn"),s=document.getElementById("dashProductBtn"),o=document.getElementById("dashSettingsBtn"),l=document.querySelectorAll(".sw-upgrade-to-pro"),i=document.getElementById("sw_service_search"),c=document.getElementById("swSearchBtn"),d=document.getElementById("search-notification"),u=document.querySelector(".sw-admin-menu-icon"),m=document.querySelectorAll(".delete-invoice-button"),p=document.querySelectorAll(".sw-delete-product"),v=document.querySelector(".delete-service-button"),h=document.querySelector(".sw-admin-dash-header"),y=document.querySelectorAll(".sw-edit-mail-nopro"),f=document.querySelectorAll(".sw-checkboxes"),w=document.getElementById("sw-hide"),g=document.querySelectorAll(".smartwoo-prevent-default"),b=document.querySelector("#smartwoo-pro-remind-later"),E=document.querySelector("#smartwoo-pro-dismiss-fornow"),S=document.querySelector("#user_data"),$=document.querySelector("#smartwooInvoiceForm"),L=document.querySelectorAll(".sw-toggle-btn"),k=document.querySelectorAll(".smartwoo-admin-invoice-action-div button"),x=document.querySelector(".smartwoo-admin-invoice-action-div"),q=document.querySelector(".smartwoo-admin-invoice-actions"),C=document.querySelector(".sw-table"),A=document.querySelector("#grace_period"),T=document.querySelector("#upload_sw_product_image"),D=document.querySelector("#add-product-galleryBtn"),P=document.querySelector(".sw-product-data-tabs-menu"),I=document.querySelector("#sw-product-form"),B=document.querySelector("#is-smartwoo-downloadable"),O=document.querySelectorAll(".swremove-field"),_=document.querySelectorAll(".sw-view-details-service-product, .admin-view-service-invoices-items, .sw-admin-subinfo, .sw-admin-client-billing-info-tab, .sw-admin-client-info-essentials, .sw-admin-client-info-pro-data, .sw-admin-client-service-invoice-pro-sell"),M=document.querySelector("#smartwooServiceUserDropdown"),N=document.querySelector("#smartwooServiceForm"),F=document.getElementById("resetFastCheckoutOptions"),j=document.querySelector("#auto-renew-btn"),H=document.querySelector("#service_products"),R=document.querySelector(".smartwoo-admin-knowledgebase");if(B){let W=document.querySelector("#add-field");B.addEventListener("change",e=>{e.preventDefault(),e.target.checked?(jQuery(".sw-assets-div").fadeIn().css("display","flex"),jQuery(".sw-product-download-field-container, .sw-service-assets-downloads-container, .sw-service-additional-assets-container").fadeIn(),jQuery(".sw-product-download-fields").fadeIn(),jQuery("#add-field").fadeIn(),jQuery(".sw-no-download-text").hide()):(jQuery(".sw-assets-div").fadeOut(),jQuery(".sw-product-download-field-container, .sw-service-assets-downloads-container, .sw-service-additional-assets-container").fadeOut(),jQuery(".sw-product-download-fields").fadeOut(),jQuery("#add-field").fadeOut(),jQuery(".sw-no-download-text").fadeIn(1e3))});document.querySelectorAll(".smartwooOpenWpMedia").forEach(e=>{e.addEventListener("click",smartwooopenWPMediaOnClick)}),W.addEventListener("click",e=>{e.preventDefault();let t=document.querySelector(".sw-product-download-field-container");t=t||document.querySelector(".sw-service-assets-downloads-container");let a=document.createElement("div"),r=document.createElement("span");a.classList.add("sw-product-download-fields"),a.innerHTML=`<input type="text" class="sw-filename" name="sw_downloadable_file_names[]" placeholder="File Name"/>
                <input type="url" class="fileUrl" name="sw_downloadable_file_urls[]" smartwoo-media-url placeholder="File URL" />
                <button class="smartwooOpenWpMedia button">Choose file</button>
            `,r.classList.add("dashicons","dashicons-dismiss"),r.style.color="red",r.style.cursor="pointer",r.setAttribute("title","remove"),a.appendChild(r),t.insertBefore(a,W),r.addEventListener("click",e=>{e.preventDefault(),jQuery(a).fadeOut(),setTimeout(()=>{a.remove()},1e3)});a.querySelector(".smartwooOpenWpMedia").addEventListener("click",smartwooopenWPMediaOnClick)})}if(e){for(let J=0;J<8;J++)e.append(t[0].cloneNode(!0));let Y=[fetchServiceCount(0,"total_services","All Services"),fetchServiceCount(1,"total_pending_services","Pending Service Orders"),fetchServiceCount(2,"total_active_services","Active Services"),fetchServiceCount(3,"total_active_nr_services","Active No Renewal"),fetchServiceCount(4,"total_due_services","Due for Renewal"),fetchServiceCount(5,"total_on_grace_services","Grace Period"),fetchServiceCount(6,"total_expired_services","Expired Services"),fetchServiceCount(7,"total_cancelled_services","Cancelled Services"),fetchServiceCount(8,"total_suspended_services","Suspended Services")];Promise.allSettled(Y).finally(()=>{document.dispatchEvent(new CustomEvent("SmartWooDashboardLoaded"))})}if(r&&r.addEventListener("click",()=>{window.location.href=smartwoo_admin_vars.new_service_page}),a&&a.addEventListener("click",()=>{window.location.href=smartwoo_admin_vars.admin_order_page}),n&&n.addEventListener("click",()=>{window.location.href=smartwoo_admin_vars.admin_invoice_page}),s&&s.addEventListener("click",()=>{window.location.href=smartwoo_admin_vars.sw_product_page}),o&&o.addEventListener("click",()=>{window.location.href=smartwoo_admin_vars.sw_options_page}),l&&l.forEach(e=>{e.addEventListener("click",()=>{window.open(smartwoo_admin_vars.smartwoo_pro_page,"_blank")})}),i&&c&&d&&(i.addEventListener("input",()=>{let e=i.value.trim();0==e.length?c.style.cursor="not-allowed":(c.style.cursor="pointer",d.style.display="none")}),c.addEventListener("click",()=>{let e=i.value.trim();e.length>0?(fetchDashboardData("sw_search",{search:e}),d.style.display="none"):(d.textContent="Search field cannot be empty.",d.style.display="block"),d.addEventListener("click",()=>{d.style.display="none"})})),u){let G=document.querySelector(".sw-admin-dash-nav");u.addEventListener("click",()=>{G.classList.toggle("show")})}if(m&&0!==m.length&&m.forEach(e=>{e.addEventListener("click",()=>{smartwooDeleteInvoice(e.getAttribute("data-invoice-id"))})}),p&&0!==p.length&&p.forEach(e=>{let t=e.getAttribute("data-product-id");e.addEventListener("click",()=>{smartwooDeleteProduct(t)})}),v){let U=v.parentElement.querySelectorAll("a button"),V=v.getAttribute("service-id");U.forEach(e=>{e.classList.add("sw-icon-button-admin")}),v.classList.add("sw-icon-button-admin"),v.addEventListener("click",()=>{smartwooDeleteService(V)})}if(h){let z=document.getElementById("contextual-help-link-wrap"),K=document.getElementById("contextual-help-wrap"),Q=document.querySelector(".contextual-help-tabs"),X=document.querySelector("#screen-meta-links");z&&(X.style.marginTop="70px",X.style.marginBottom="10px",K.style.zIndex="3",Q.style.backgroundColor="#ffffff"),document.addEventListener("scroll",()=>{window.scrollY>0?h.classList.add("is-scrolled"):h.classList.remove("is-scrolled"),window.matchMedia("( min-width: 19px) and (max-width: 600px )").matches&&(window.scrollY>20?h.style.top="0":h.style.top="35px")})}if(y&&y.forEach(e=>{e.addEventListener("click",()=>{smartwoo_pro_ad("Email Template Edit","Email template editing is exclusively available in Smart Woo Pro")})}),j&&j.addEventListener("click",()=>{smartwoo_pro_ad("Auto Renew Service","Automatic service renewal from the backend is exclusively available in Smart Woo Pro.")}),f&&f.forEach(e=>{e.addEventListener("mouseover",()=>{e.checked?e.setAttribute("title","disable"):e.setAttribute("title","enable")})}),w&&(w.style.cursor="pointer",w.addEventListener("click",e=>{e.preventDefault(),jQuery(w.parentElement).fadeOut()})),g&&g.forEach(e=>{let t=null;e.addEventListener("click",a=>{a.preventDefault(),(t=window.open("","_blank")).location.href=e.getAttribute("href"),e.disabled=!0,e.setAttribute("title","Tab is open.");let r=()=>{t&&t.closed&&(e.disabled=!1,e.removeAttribute("title"),e.style.cursor="pointer",document.removeEventListener("scroll",r))};document.addEventListener("scroll",r),e.disabled&&(e.style.cursor="not-allowed")})}),b&&b.addEventListener("click",()=>{smartwooProBntAction("remind_later")}),E&&E.addEventListener("click",()=>{smartwooProBntAction("dismiss_fornow")}),S){let Z=!1,ee=document.querySelector(".sw-guest-option"),et=document.querySelector(".sw-invoice-form-meta"),ea=()=>{et.querySelectorAll("input").forEach(e=>{"is_guest_invoice"===e.name?(e.value="",e.value="no"):e.value=""}),Z&&(S.querySelector(`option[value="${Z}"]`).remove(),Z=!Z),ee&&(ee.remove(),showNotification("The origial invoice owner has been changed",7e3)),$&&($.querySelector("#fullname").textContent="",$.querySelector("#billingAddress").textContent="",$.querySelector("#billingPhone").textContent="",$.querySelector("#companyName").textContent="",$.querySelector("#billingEmail").textContent="")},er=()=>{if($){let e=S.value;if(e){let t=e.split("|")[0];if(t<1){showNotification("This user does not exist.",5e3);return}let a=new URL(smart_woo_vars.get_user_data),r=smartWooAddSpinner("swloader");a.searchParams.append("user_id",t),a.searchParams.append("security",smart_woo_vars.security),fetch(a,{method:"GET"}).then(e=>{if(!e.ok)throw showNotification(`Error: ${e.statusText}`,6e3),Error(e.statusText);return e.json()}).then(e=>{if(e.success){let t=e.data.user;$.querySelector("#fullname").textContent=t.full_name,$.querySelector("#billingAddress").textContent=t.formated_address,$.querySelector("#billingPhone").textContent=t.billing_phone,$.querySelector("#companyName").textContent=t.billing_company,$.querySelector("#billingEmail").textContent=t.billing_email}else showNotification(e.data.message,6e3)}).catch(e=>{console.error("Error fetching user data:",e)}).finally(()=>{smartWooRemoveSpinner(r)})}}};S.addEventListener("change",async e=>{let t=document.querySelector(".sw-guest-option");if(e.target.value.length&&(t&&t.value)!==e.target.value&&("smartwoo_guest"!==e.target.value&&(ea(),er()),"smartwoo_guest"===e.target.value)){let a=await smartwooPromptGuestInvoiceData("Enter Guest Details");if(!a){if(t){S.value=t.value;return}ea(),S.value="";return}if(!a.billing_email.length){if(showNotification("The billing email is required.",5e3),t){S.value=t.value;return}S.value="";return}let r=`${a.first_name?a.first_name+" "+a.last_name:"Guest"} (${a.billing_email})`,n=`-1|${a.billing_email}`;ea();let s=document.createElement("option");s.value=n,s.text=r,s.classList.add("sw-guest-option"),S.prepend(s),S.value=s.value,Z=n,et.querySelector('input[name="first_name"]').value=a.first_name,et.querySelector('input[name="last_name"]').value=a.last_name,et.querySelector('input[name="billing_address"]').value=a.billing_address,et.querySelector('input[name="billing_phone"]').value=a.billing_phone,et.querySelector('input[name="billing_company"]').value=a.billing_company,et.querySelector('input[name="billing_email"]').value=a.billing_email,et.querySelector('input[name="is_guest_invoice"]').value="yes",$&&($.querySelector("#fullname").textContent=`${a.first_name} ${a.last_name}`,$.querySelector("#billingAddress").textContent=a.billing_address,$.querySelector("#billingPhone").textContent=a.billing_phone,$.querySelector("#companyName").textContent=a.billing_company,$.querySelector("#billingEmail").textContent=a.billing_email)}})}if($){H&&smartwooInvoiceEditorItemCalculator(H);$.querySelectorAll("[required]").forEach(e=>{let t=e.getAttribute("field-name");e.value.trim().length||e.setCustomValidity(`${t||"This field"} is required`),e.addEventListener("input",()=>{e.value.trim().length&&e.setCustomValidity("")})}),$.addEventListener("submit",e=>{e.preventDefault();let t=$.querySelector('button[type="submit"]');t.setAttribute("disabled",!0);let a=smartWooAddSpinner("swloader",!0),r=document.getElementById("invoice-errors");r&&r.remove();let n=new FormData($);n.append("security",smartwoo_admin_vars.security),fetch(smartwoo_admin_vars.ajax_url,{method:"POST",body:n}).then(e=>{if(!e.ok)throw showNotification(e.statusText,6e3),Error(`Error: ${e.status} ${e.statusText}`);return e.json()}).then(e=>{if(e.success)showNotification(e.data.message?e.data.message:"Invoice Created",3e3),setTimeout(()=>{window.location.href=e.data.redirect_url},3e3);else{let a=document.createElement("div");a.id="invoice-errors",a.innerHTML=e.data.htmlContent?e.data.htmlContent:e.data.message;let r=a.querySelector(".swremove-field");r&&r.addEventListener("click",e=>e.target.parentElement.remove()),$.parentElement.insertBefore(a,$),window.scrollTo({top:0,left:0,behavior:"smooth"}),t.removeAttribute("disabled")}}).catch(e=>{console.error("Fetch error:",e),t.removeAttribute("disabled")}).finally(()=>{smartWooRemoveSpinner(a)})})}if(L.length){let en=L[1],es=L[0],eo=document.querySelector(".smartwoo-admin-invoice-billing-info"),el=document.querySelector(".smartwoo-admin-invoice-items");en.addEventListener("click",()=>{eo.classList.contains("smartwoo-hide")?(eo.classList.remove("smartwoo-hide"),en.style.borderBottom="solid #000000"):(eo.classList.add("smartwoo-hide"),en.style.borderBottom="none")}),es.addEventListener("click",()=>{el.classList.contains("smartwoo-hide")?(el.classList.remove("smartwoo-hide"),es.style.borderBottom="solid #000000"):(el.classList.add("smartwoo-hide"),es.style.borderBottom="none")})}if(k.length&&k.forEach(e=>{let t=document.querySelector("#response-div");e.addEventListener("click",()=>{let a=t.getAttribute("data-invoice-id"),r=e.getAttribute("data-value");if(t.innerHTML="","send_payment_reminder"===r&&!confirm("Are you sure you want to send a payment reminder email to the user?")||"send_new_email"===r&&!confirm("Are you sure you want to send a new invoice email to the user?"))return;spinner=smartWooAddSpinner("swSpinner",!0);let n=new URL(smartwoo_admin_vars.ajax_url);n.searchParams.append("action","smartwoo_admin_invoice_action"),n.searchParams.append("real_action",r),n.searchParams.append("invoice_id",a),n.searchParams.append("security",smartwoo_admin_vars.security),fetch(n,{method:"GET"}).then(e=>{if(!e.ok)throw showNotification(e.statusText,6e3),Error(`Error: ${e.status} ${e.statusText}`);return e.json()}).then(e=>{if(e.success){if("checkout_order_pay"===r||"paymen_url"===r){let a=document.createElement("h3"),n=document.createElement("input"),s="checkout_order_pay"===r?"Checkout Link":"Payment Link";a.textContent=s,a.style.textAlign="center",n.readOnly=!0,n.id="smartwoo-invoice-links-input";let o=document.createElement("span");o.classList.add("dashicons","dashicons-admin-page"),o.setAttribute("title","copy to clipboard"),o.style.cursor="pointer",o.style.marginTop="10px",n.value=e.data.message,t.appendChild(a),t.appendChild(n),t.appendChild(o),o.addEventListener("click",async()=>{navigator.clipboard.writeText(n.value),showNotification("Copied")})}else t.innerHTML=e.data.message}else t.innerHTML=e.data.message,showNotification(e.data.message,6e3)}).catch(e=>{console.error("Fetch error:",e)}).finally(()=>{smartWooRemoveSpinner(spinner)})})}),q&&x&&q.addEventListener("click",()=>{x.classList.toggle("active")}),C){let ei=C.querySelector("#swTableCheckMaster"),ec=C.querySelectorAll(".sw-table-body-checkbox"),ed=[],eu=()=>{let e=document.querySelector(".sw-action-container");e&&e.remove()},em=()=>{ed.length&&(ed=[...new Set(ed)],document.dispatchEvent(new CustomEvent("smartwooTableChecked",{detail:ed})))};ei&&ei.addEventListener("change",()=>{eu(),ec.forEach(e=>{(isChecked=ei.checked)?(e.checked=!0,ed.push(e.getAttribute("data-value")),em()):(e.checked=!1,ed=ed.filter(t=>t!==e.getAttribute("data-value")))})}),ec.length&&ec.forEach(e=>{e.addEventListener("change",()=>{eu(),e.checked?(ed.push(e.getAttribute("data-value")),em()):ed=ed.filter(t=>t!==e.getAttribute("data-value")),ec.length===ed.length?ei.checked=!0:ei.checked=!1})})}if(A&&A.addEventListener("change",()=>{let e=document.querySelector(".grace-period-number"),t=document.querySelector(".description-class span");A.value.length?(e.readOnly=!1,t.textContent=" after",e.value.length||(e.value=7)):(e.value="",t.textContent="",e.readOnly=!0)}),T){let ep,ev=document.querySelector("#product_image_id"),eh=document.querySelector("#image_preview");T.addEventListener("click",e=>{if(e.preventDefault(),"remove"===T.value){jQuery(eh).fadeOut(),setTimeout(()=>{eh.innerHTML=""},1e3),T.value="Upload",ev.value="";return}if(ep){ep.open();return}(ep=wp.media({title:"Product Image",button:{text:"Set Product Image"},multiple:!1})).on("select",()=>{eh.innerHTML="",ev.value="";let e=ep.state().get("selection").first().toJSON(),t=document.createElement("img");ev.value=e.id,t.src=e.url,t.style.maxWidth="100%",eh.appendChild(t),jQuery(eh).fadeIn(),T.value="remove"}),ep.open()})}if(D){let ey=document.querySelectorAll(".sw-image-img");ey.length&&ey.forEach(e=>{let t=e.querySelector("span");e.addEventListener("mouseover",()=>{t.classList.add("active")}),e.addEventListener("mouseleave",()=>{t.classList.remove("active")}),t.addEventListener("click",t=>{t.preventDefault(),jQuery(e).fadeOut(),setTimeout(()=>{e.remove()},2e3)})});let ef,ew=document.querySelector("#sw-product-gallery-preview");D.addEventListener("click",e=>{if(e.preventDefault(),ef){ef.open();return}(ef=wp.media({title:"Select Images",button:{text:"Use these images"},multiple:!0})).on("select",()=>{ef.state().get("selection").each(e=>{let t=e.toJSON(),a=document.createElement("div"),r=document.createElement("span"),n=document.createElement("img"),s=document.createElement("input");a.classList.add("sw-image-img"),r.classList.add("dashicons","dashicons-dismiss"),n.src=t.url,s.name="product_gallery_ids[]",s.type="hidden",s.value=t.id,a.appendChild(r),a.appendChild(s),a.appendChild(n),ew.appendChild(a),r.addEventListener("click",e=>{e.preventDefault(),jQuery(a).fadeOut(),setTimeout(()=>{a.remove()},2e3)}),a.addEventListener("mouseover",()=>{r.classList.add("active")}),a.addEventListener("mouseleave",()=>{r.classList.remove("active")})})}),ef.open()})}if(P){let e8=P.querySelectorAll("li"),eg=document.querySelector(".sw-product-data-tabs-content").querySelectorAll("div"),eb=()=>{eg.forEach(e=>{e.classList.contains("smartwoo-hide")||e.classList.add("smartwoo-hide")}),e8.forEach(e=>{e.classList.remove("active")})};e8.forEach((e,t)=>{e.addEventListener("click",e=>{eb(),e.target.classList.add("active"),eg[t].classList.remove("smartwoo-hide")})})}if(I&&I.addEventListener("submit",e=>{e.preventDefault(),window.tinymce&&window.tinymce.editors.forEach(e=>e.save());let t=document.querySelector("#response-container");t.innerHTML="";let a=smartWooAddSpinner("swloader",!0),r=new FormData(I),n=new URL(smartwoo_admin_vars.ajax_url);r.append("security",smart_woo_vars.security),fetch(n,{method:"POST",body:r}).then(e=>{if(!e.ok)throw showNotification(e.statusText,6e3),Error(`Error: ${e.status} ${e.statusText}`);return e.json()}).then(e=>{if(e.success?showNotification(e.data.message,3e3):showNotification(e.data.message,6e3),window.location.search.includes("tab=edit")&&e.success){window.location.reload();return}t.innerHTML=e.data.htmlContent?e.data.htmlContent:e.data.message,window.scrollTo({top:0,left:0,behavior:"smooth"}),t.querySelector(".swremove-field").addEventListener("click",e=>e.target.parentElement.remove())}).catch(e=>{console.error("Error:",e)}).finally(()=>{smartWooRemoveSpinner(a)})}),O&&O.forEach(e=>{e.addEventListener("click",t=>{t.preventDefault(),e.parentElement.remove()})}),_.length&&_.forEach(e=>{e.addEventListener("mouseover",()=>{e.classList.add("active")}),e.addEventListener("mouseleave",()=>{e.classList.remove("active")})}),M){let eE=document.querySelector(".sw-service-client-info"),eS=eE.querySelector(".sw-user-fullname"),e$=eE.querySelector(".sw-user-email"),eL=eE.querySelector("img"),ek=smart_woo_vars.default_avatar_url,ex="No user selected";M.addEventListener("change",e=>{if(!e.target.value.length){eS.textContent=ex,e$.textContent="",eL.src=ek;return}let t=smartWooAddSpinner("spinner",!1);t.style.position="absolute",t.style.left="50%",t.style.top="50%";let a=e.target.value.split("|")[0],r=new URL(smart_woo_vars.get_user_data);r.searchParams.append("user_id",a),r.searchParams.append("security",smart_woo_vars.security),fetch(r,{method:"GET"}).then(e=>{if(!e.ok)throw showNotification(`Error: ${e.statusText}`,6e3),Error(e.statusText);return e.json()}).then(e=>{e.success?(eS.innerHTML=`<strong>Full name</strong>: ${e.data.user.full_name}`,e$.innerHTML=`<strong>Email</strong>: ${e.data.user.email}`,eL.src=e.data.user.avatar_url):showNotification(e.data.message,6e3)}).catch(e=>{console.error("Error fetching user data:",e)}).finally(()=>{smartWooRemoveSpinner(t)})})}if(N&&(N.querySelectorAll("[required]").forEach(e=>{e.addEventListener("invalid",()=>{let t=e.getAttribute("field-name")||"This field";e.setCustomValidity(`${t} is required.`)}),e.addEventListener("input",function(){e.setCustomValidity("")})}),reponseDiv=document.querySelector("#response-container"),N.addEventListener("submit",e=>{e.preventDefault(),SmartWooEditor.saveAll(),reponseDiv.innerHTML="";let t=smartWooAddSpinner("swloader",!0),a=N.querySelector('button[type="submit"]'),r=new FormData(N),n=new URL(smart_woo_vars.ajax_url);r.append("security",smart_woo_vars.security),a.disabled=!0,fetch(n,{method:"POST",body:r}).then(e=>{if(!e.ok)throw showNotification(`Error: ${e.statusText}`,6e3),Error(`Error: ${e.statusText}`);return e.json()}).then(e=>{e.success?(showNotification(e.data.message,3e3),setTimeout(()=>{window.location.href=e.data.redirect_url},3e3)):(showNotification(`Error: ${e.data.message}`,6e3),reponseDiv.innerHTML=e.data.htmlContent,window.scrollTo({top:0,left:0,behavior:"smooth"}),reponseDiv.querySelector(".swremove-field").addEventListener("click",e=>e.target.parentElement.remove()))}).catch(e=>{console.error(e)}).finally(()=>{smartWooRemoveSpinner(t),a.disabled=!1})})),F&&F.addEventListener("click",e=>{e.preventDefault();if(!confirm("All your customizations will be lost!"))return;let t=new URL(smart_woo_vars.ajax_url);t.searchParams.set("action","smartwoo_reset_fast_checkout"),t.searchParams.set("security",smart_woo_vars.security),fetch(t).then(e=>{e.ok?window.location.reload():showNotification(`Error: ${e.statusText}`)})}),R){let eq=R.querySelectorAll(".smartwoo-knowledgebase-nav"),eC=document.querySelectorAll(".sw-knowledgebase-content"),eA=()=>{eC.forEach(e=>{e.classList.contains("smartwoo-hide")||e.classList.add("smartwoo-hide")}),eq.forEach(e=>{e.classList.contains("active")&&e.classList.remove("active")})};eq.forEach((e,t)=>{e.addEventListener("click",e=>{e.preventDefault(),eA(),e.target.classList.add("active"),eC[t].classList.remove("smartwoo-hide")})})}}),document.addEventListener("SmartWooDashboardLoaded",()=>{let e=document.querySelectorAll(".sw-dash-content"),t=document.getElementById("dashboardBtn"),a=document.querySelector(".sw-dash-content-container"),r=document.querySelector(".sw-dash-pro-sell-bg");e.forEach((e,t)=>{e.addEventListener("click",e=>{!e.target.matches(".sw-red-button")&&(smartwooRemoveTable(),fetchDashboardData(t,{limit:25}))})}),t.addEventListener("click",()=>{smartwooRemoveTable(),jQuery(a).fadeIn().css("display","flex")}),r&&setTimeout(()=>{jQuery(r).fadeIn()},5e3)}),document.addEventListener("smartwooTableChecked",e=>{let t=smart_woo_vars.currentScreen;"Service Orders"===t&&smartwooBulkActionForTable({options:[{value:"delete",text:"Delete"},{value:"complete",text:"Complete"},],selectedRows:e.detail,hookName:"order_table_actions"}),"Invoices"===t&&smartwooBulkActionForTable({options:[{value:"paid",text:"Paid"},{value:"unpaid",text:"Unpaid"},{value:"due",text:"Due"},{value:"cancelled",text:"Cancelled"},{value:"delete",text:"Delete"},],selectedRows:e.detail,hookName:"invoice_table_actions"}),"Service Products"===t&&smartwooBulkActionForTable({options:[{value:"publish",text:"Publish"},{value:"private",text:"Private"},{value:"pending",text:"Pending"},{value:"draft",text:"Draft"},{value:"trash",text:"Move to trash"},{value:"delete",text:"Delete"},],selectedRows:e.detail,hookName:"product_table_actions"})}),document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("more-addi-assets"),t=document.getElementById("additionalAssets"),a=document.getElementById("isExternal");if(e&&t&&(e.addEventListener("click",function(a){a.preventDefault();var r=document.createElement("div");r.classList.add("sw-additional-assets-field"),r.style.display="none";let n=`sw-editor-${Date.now()}-${Math.floor(1e3*Math.random())}`;r.innerHTML=`
				<hr>
				<h4>
					Asset type:
					<input type="text" name="additional_asset_types[]" placeholder="eg. water billing asset..." />
				</h4>
				<input type="text" name="additiional_asset_names[]" placeholder="Asset Name" />
				<input type="number" name="access_limits[]" class="sw-form-input" min="-1" placeholder="Limit (optional)">
				<textarea id="${n}" class="smartwoo-asset-editor-ui" name="additional_asset_values[]" placeholder="Start building: rich text, immersive audio & video playlists, stunning image galleries, custom HTML, or shortcodes."></textarea>
                <span class="dashicons dashicons-dismiss remove-field" title="Remove this field"></span>
            `,t.insertBefore(r,e);let s=new SmartWooEditor(`#${n}`);s.init().then(()=>jQuery(r).fadeIn())}),t.addEventListener("click",e=>{if(e.target.classList.contains("remove-field")){e.preventDefault();let t=e.target.parentElement,a=e.target.getAttribute("data-asset-id");if(a&&confirm("This asset will be deleted from the database, click okay to continue.")){let r=smartWooAddSpinner("swloader",!0),n=new FormData,s=smart_woo_vars.ajax_url;n.set("action","smartwoo_asset_delete"),n.set("security",smart_woo_vars.security),n.set("asset_id",a),fetch(s,{method:"POST",body:n,credentials:"same-origin"}).then(e=>{if(!e.ok)throw Error(`Fetch Error: ${e.statusText}`);return e.json()}).then(e=>{e.success&&jQuery(t).fadeOut("slow",()=>t.remove()),showNotification(e.data.message,5e3)}).catch(e=>{console.error(e)}).finally(()=>smartWooRemoveSpinner(r))}else a||jQuery(t).fadeOut("slow",()=>t.remove())}})),a){var r=document.getElementById("auth-token-div");a.addEventListener("change",function(e){e.preventDefault(),"yes"===a.value?jQuery(r).fadeIn():jQuery(r).fadeOut()})}});