function smartwooFastCheckout(){let e=document.querySelectorAll(".product_type_sw_product.add_to_cart_button");e.length&&e.forEach(e=>{e.addEventListener("click",smartwooOpenModal)})}function smartwooOpenModal(e){let t=e.target.closest("li"),o=smart_woo_vars.fast_checkout_config;t||(t=e.target.closest(".configure-product-button"));let r=t.querySelector(".smartwoo-product-data");if(!r){console.warn("Product config not found. Fast checkout prevented.");return}e.preventDefault();let a=JSON.parse(r.getAttribute("smartwoo-product-config")),n=a.id,s=document.querySelector(".sw-fast-checkout-main"),d=()=>{jQuery(modal=document.querySelector(".smartwoo-modal-frame")).fadeOut("fast",()=>{modal.remove()})};s&&d();let l=document.createElement("div"),c=document.createElement("div"),i=document.createElement("span"),u=document.createElement("h3"),p=document.createElement("div");l.classList.add("smartwoo-modal-frame"),c.setAttribute("style",`background-color: ${o.modal_background_color};`),l.appendChild(c);let m=o.title.replace("{{product_name}}",`"${a.name}"`||"");u.textContent=m,u.setAttribute("style",`padding: 5px; color: ${o.title_color}`),u.style.padding="5px";let f=`
        <div id="response"></div>
        <div class="smartwoo-fast-checkout-description">
            <img src="${a.image_url}" alt="${a.name}">
            <span>${o.description}</span>
        </div>
        <input type="text" name="service_name" id="service_name" placeholder="${o.service_name_placeholder}"/>
        <input type="text" name="service_url" id="service_url" placeholder="${o.url_placeholder}"/>
        <button class="sw-blue-button" style="background-color: ${o.button_background_color}; color: ${o.button_text_color};">${o.checkout_button_text}</button>
        <div id="loader" style="background-color:rgba(255, 255, 255, 0); text-align: center; display: none;"></div>

    `;i.setAttribute("style","float: right; color:rgb(248, 100, 100); margin-right: 4px; cursor: pointer; font-size: 24px"),i.setAttribute("class","dashicons dashicons-dismiss"),c.classList.add("sw-fast-checkout-main"),p.classList.add("sw-flex-column"),p.style.position="relative",p.innerHTML=f,u.appendChild(i),c.appendChild(u),c.appendChild(p),document.body.prepend(l),jQuery(l).fadeIn("slow"),i.addEventListener("click",()=>{d()}),l.addEventListener("click",e=>{e.target===l&&d()});let g=e=>{("Escape"===e.key||"Esc"===e.key)&&(d(),document.removeEventListener("keydown",g))};document.addEventListener("keydown",g);let h=c.querySelector("#response");h.style.border="solid 1px #dcdcde",h.style.padding="5px",h.style.minHeight="40px",h.style.display="none";let b=c.querySelector("button"),y;b.addEventListener("click",e=>{var t;jQuery(h).fadeOut(),b.setAttribute("disabled",!0);let o=c.querySelector("#service_name"),r=c.querySelector("#service_url");if(!o.value.trim().length){h.innerHTML="Please enter a service name",jQuery(h).fadeIn(),b.removeAttribute("disabled");return}y||(y=smartWooAddSpinner("loader",!0)),jQuery(y).show();let a,s=(t=c,a=[" #ffffff"," #e2def5","rgb(129, 122, 122)"," #b3afaf","rgb(61, 196, 250)"],setInterval(()=>{t.style.backgroundColor=a[Math.floor(Math.random()*a.length)]},200));y.style.position="absolute",y.style.top="20%",y.style.left="40%";let d=new FormData;d.append("security",smart_woo_vars.security),d.append("product_id",n),d.append("service_name",o.value),d.append("service_url",r.value),d.append("action","smartwoo_configure_product"),fetch(smart_woo_vars.ajax_url,{method:"POST",body:d}).then(e=>{if(!e.ok)throw h.innerHTML="Request cannot be completed",h.style.border="solid 1px #dcdcde",Error(e.statusText,6e3);return e.json()}).then(e=>{e.success?(h.style.border="solid 1px #dcdcde",h.innerHTML=e.data.message?e.data.message:"Product configured, redirecting to checkout.",window.location.href=e.data.checkout,jQuery(h).show()):(h.innerHTML=e.data.message?e.data.message:"Something went wrong.",jQuery(h).show())}).catch(e=>{console.error(e),jQuery(h).show()}).finally(()=>{jQuery(y).hide(),b.removeAttribute("disabled"),clearInterval(s)})})}document.addEventListener("DOMContentLoaded",smartwooFastCheckout);