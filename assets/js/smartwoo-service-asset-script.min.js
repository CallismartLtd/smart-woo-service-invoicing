class SmartwooAudioPlayer{constructor(e){this.assetAudioPlayer=e,this.audio=document.createElement("audio"),this.playlist=this._parsePlaylist(),this.currentTrackIndex=0,this.isPlaying=!1,this.isSeeking=!1,this.isVolumeDragging=!1,this.lastVolume=localStorage.getItem("smartwoo-audio-volume")?parseFloat(localStorage.getItem("smartwoo-audio-volume")):.5,this.audio.volume=this.lastVolume,this._cacheElements(),this._bindEvents(),this._initPlayer()}_parsePlaylist(){let e=this.assetAudioPlayer.dataset.playlist;return e?JSON.parse(decodeURIComponent(e).replace(/&quot;/g,'"')):[]}_reparsePlaylist(){let e=this.assetAudioPlayer.closest(".smartwoo-audio-playlist"),t=e?.getAttribute("data-playlist");this.playlist=t?JSON.parse(decodeURIComponent(t).replace(/&quot;/g,'"')):this.playlist}_cacheElements(){let e=this.assetAudioPlayer;this.playBtn=e.querySelector(".smartwoo-play"),this.pauseBtn=e.querySelector(".smartwoo-pause"),this.prevBtn=e.querySelector(".smartwoo-prev"),this.nextBtn=e.querySelector(".smartwoo-next"),this.progressContainer=e.querySelector(".smartwoo-audio-player__progress"),this.progressBar=e.querySelector(".smartwoo-progress-bar"),this.currentTimeSpan=e.querySelector(".smartwoo-time-current"),this.durationSpan=e.querySelector(".smartwoo-time-duration"),this.volumeToggleIcon=e.querySelector(".smartwoo-volume-toggle"),this.volumeSliderContainer=e.querySelector(".smartwoo-volume-slider"),this.volumeProgressBar=e.querySelector(".smartwoo-volume-progress"),this.currentTitleSpan=e.querySelector(".smartwoo-current-title"),this.currentArtistSpan=e.querySelector(".smartwoo-current-artist"),this.thumbnailImg=e.querySelector(".smartwoo-thumbnail"),this.playlistItemsContainer=e.querySelector("ul.smartwoo-playlist"),this.playlistToggle=e.querySelector(".smartwoo-audio-player__control-group.smartwoo-playlist-control .dashicons-playlist-audio")}_formatTime(e){if(isNaN(e)||e<0)return"0:00";let t=Math.floor(e%60);return`${Math.floor(e/60)}:${t<10?"0":""}${t}`}_escHtml(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}loadTrack(e){if(e<0){console.warn("Track index out of bounds:",e);return}e>=this.playlist.length&&this._reparsePlaylist(),this.currentTrackIndex=e;let t=this.playlist[this.currentTrackIndex];this.audio.src=t.url,this.currentTitleSpan.textContent=this._escHtml(t.title),this.currentArtistSpan.textContent=this._escHtml(t.artist),this.thumbnailImg.src=this._escHtml(t.thumbnail),this.thumbnailImg.alt=this._escHtml(t.title||"Audio thumbnail"),this.progressBar?.style.setProperty("width","0%"),this.currentTimeSpan.textContent="0:00",this.durationSpan.textContent="0:00",this.playlistItemsContainer.querySelectorAll(".smartwoo-playlist__item").forEach(e=>{e.classList.remove("is-active")});let i=this.playlistItemsContainer.querySelector(`[data-index="${this.currentTrackIndex}"]`);i&&i.classList.add("is-active"),this.audio.load(),this.isPlaying&&this.audio.play().catch(e=>console.warn("Autoplay prevented:",e))}togglePlayPause=()=>{this.isPlaying?(this.audio.pause(),this.isPlaying=!1,this.playBtn.style.removeProperty("display"),this.pauseBtn.style.setProperty("display","none")):(this.audio.play().catch(e=>console.error("Autoplay prevented:",e)),this.isPlaying=!0,this.playBtn.style.setProperty("display","none"),this.pauseBtn.style.removeProperty("display"))};mute=()=>{this.audio.volume>0?(this.lastVolume=this.audio.volume,this.audio.volume=0):this.audio.volume=this.lastVolume>0?this.lastVolume:.5,this._updateVolumeBar({clientX:this.volumeSliderContainer.getBoundingClientRect().width*this.audio.volume+this.volumeSliderContainer.getBoundingClientRect().left})};next=()=>{let e=this.currentTrackIndex<this.playlist.length-1?this.currentTrackIndex+1:0;this.loadTrack(e)};prev=()=>{let e=this.currentTrackIndex>0?this.currentTrackIndex-1:this.playlist.length-1;this.loadTrack(e)};togglePlaylist=()=>{this.assetAudioPlayer.classList.toggle("playlist-active")};_updateSeekBar=e=>{let t=this.progressContainer.getBoundingClientRect(),i=e.clientX||(e.touches&&e.touches[0]?e.touches[0].clientX:0),s=i-t.left;s=Math.max(0,Math.min(s,t.width));let r=s/t.width;this.progressBar.style.width=`${100*r}%`,this.currentTimeSpan.textContent=this._formatTime(r*this.audio.duration),this.isSeeking&&(this.audio.currentTime=r*this.audio.duration)};_updateVolumeBar=e=>{let t=this.volumeSliderContainer.getBoundingClientRect(),i=e.clientX||(e.touches&&e.touches[0]?e.touches[0].clientX:0),s=i-t.left,r=(s=Math.max(0,Math.min(s,t.width)))/t.width;isNaN(r)&&(r=this.lastVolume),this.audio.volume=r,this.volumeProgressBar?.style.setProperty("width",`${100*r}%`),0===this.audio.volume?(this.volumeToggleIcon.className="dashicons dashicons-controls-volumeoff smartwoo-volume-toggle",this.volumeToggleIcon.title="Unmute"):(this.volumeToggleIcon.className="dashicons dashicons-controls-volumeon smartwoo-volume-toggle",this.volumeToggleIcon.title="Mute"),localStorage.setItem("smartwoo-audio-volume",this.audio.volume)};_onClickPlaylistItem=e=>{let t=e.target.closest(".smartwoo-playlist__item");if(t){let i=parseInt(t.dataset.index);i===this.currentTrackIndex||(this.loadTrack(i),this.isPlaying||this.togglePlayPause())}};_onLoadedMetadataCallback=()=>{this.durationSpan.textContent=this._formatTime(this.audio.duration),this.isPlaying||this.audio.autoplay||this.audio.pause(),this._updateVolumeBar({clientX:this.volumeSliderContainer.getBoundingClientRect().width*this.audio.volume+this.volumeSliderContainer.getBoundingClientRect().left})};_syncProgress=()=>{if(!this.isSeeking){let e=this.audio.currentTime/this.audio.duration*100;this.progressBar?.style.setProperty("width",`${e}%`),this.currentTimeSpan.textContent=this._formatTime(this.audio.currentTime)}};_onEndedCallback=()=>{this.currentTrackIndex<this.playlist.length-1?(this.loadTrack(this.currentTrackIndex+1),this.audio.play()):this.loadTrack(0)};_catch=e=>{console.error("Audio error:",e),this.isPlaying&&(this.isPlaying=!1,this.playBtn.style.removeProperty("display"),this.pauseBtn.style.setProperty("display","none"),this.audio.pause())};_bindEvents(){this.playBtn.addEventListener("click",this.togglePlayPause),this.pauseBtn.addEventListener("click",this.togglePlayPause),this.playlistToggle.addEventListener("click",this.togglePlaylist),this.playlistItemsContainer.addEventListener("click",this._onClickPlaylistItem),this.audio.addEventListener("loadedmetadata",this._onLoadedMetadataCallback),this.audio.addEventListener("timeupdate",this._syncProgress),this.audio.addEventListener("ended",this._onEndedCallback),this.audio.addEventListener("error",this._catch),this.prevBtn.addEventListener("click",this.prev),this.nextBtn.addEventListener("click",this.next),this.volumeToggleIcon.addEventListener("click",this.mute),this.progressContainer.addEventListener("mousedown",e=>{this.isSeeking=!0,this._updateSeekBar(e),this.assetAudioPlayer.addEventListener("mousemove",this._updateSeekBar),this.assetAudioPlayer.addEventListener("mouseup",()=>{this.isSeeking=!1,this.assetAudioPlayer.removeEventListener("mousemove",this._updateSeekBar),this.isPlaying&&this.audio.play()},{once:!0})}),this.progressContainer.addEventListener("touchstart",e=>{this.isSeeking=!0,this._updateSeekBar(e)}),this.assetAudioPlayer.addEventListener("touchmove",e=>{this.isSeeking&&(this._updateSeekBar(e),e.preventDefault())},{passive:!1}),this.assetAudioPlayer.addEventListener("touchend",()=>{this.isSeeking&&(this.isSeeking=!1,this.isPlaying&&this.audio.play())}),this.volumeSliderContainer.addEventListener("mousedown",e=>{this.isVolumeDragging=!0,this._updateVolumeBar(e),this.assetAudioPlayer.addEventListener("mousemove",this._updateVolumeBar),this.assetAudioPlayer.addEventListener("mouseup",()=>{this.isVolumeDragging=!1,this.assetAudioPlayer.removeEventListener("mousemove",this._updateVolumeBar)},{once:!0})}),this.volumeSliderContainer.addEventListener("touchstart",e=>{this.isVolumeDragging=!0,this._updateVolumeBar(e)}),this.assetAudioPlayer.addEventListener("touchmove",e=>{this.isVolumeDragging&&(this._updateVolumeBar(e),e.preventDefault())},{passive:!1}),this.assetAudioPlayer.addEventListener("touchend",()=>{this.isVolumeDragging&&(this.isVolumeDragging=!1)})}_initPlayer(){this.playlist.length>0?this.loadTrack(0):console.warn("Audio playlist is empty.")}}class SmartwooVideoPlayer{constructor(e){this.assetVideoPlayer=e,this.video=this.assetVideoPlayer.querySelector("video.smartwoo-video-player__video"),this.playlist=this._parsePlaylist(),this.currentTrackIndex=0,this.isPlaying=!1,this.isSeeking=!1,this.isVolumeDragging=!1,this.lastVolume=localStorage.getItem("smartwoo-audio-volume")?parseFloat(localStorage.getItem("smartwoo-audio-volume")):.5,this.isFullScreenMode=!1,this.isPortriate=!1,this.controlsTimout=null,this.video.volume=this.lastVolume,this._cacheElements(),this._bindEvents(),this._initPlayer()}_parsePlaylist(){let e=this.assetVideoPlayer.dataset.playlist;return e?JSON.parse(decodeURIComponent(e).replace(/&quot;/g,'"')):[]}_reparsePlaylist(){let e=this.videoFrame.closest(".smartwoo-video-player-container"),t=e?.getAttribute("data-playlist");this.playlist=t?JSON.parse(decodeURIComponent(t).replace(/&quot;/g,'"')):this.playlist}_cacheElements(){let e=this.assetVideoPlayer;this.videoFrame=e.querySelector(".smartwoo-video-player__frame"),this.progressContainer=e.querySelector(".smartwoo-video-player__progress"),this.progressBar=e.querySelector(".smartwoo-progress-bar "),this.currentTimeSpan=e.querySelector(".smartwoo-video-player_timing-current"),this.durationSpan=e.querySelector(".smartwoo-video-player_timing-duration"),this.tooltip=e.querySelector(".smartwoo-seek-tooltip"),this.volumeToggleIcon=e.querySelector(".smartwoo-video-volume-toggle"),this.volumeSliderContainer=e.querySelector(".smartwoo-video-volume-slider"),this.volumeProgressBar=e.querySelector(".smartwoo-video-volume-progress"),this.volumeScruber=e.querySelector(".smartwoo-video-volume-scrubber"),this.currentTitleSpan=e.querySelector(".smartwoo-current-title"),this.currentArtistSpan=e.querySelector(".smartwoo-current-artist"),this.playlistToggle=e.querySelectorAll(".smartwoo-video-playlist-toggle"),this.playlistItemsContainer=e.querySelector("ul.smartwoo-video-player-playlist-container"),this.fullscreenToggle=e.querySelector(".smartwoo-video-fullscreen-toggle"),this.playBtn=e.querySelector(".smartwoo-play"),this.pauseBtn=e.querySelector(".smartwoo-pause"),this.prevBtn=e.querySelector(".smartwoo-prev"),this.nextBtn=e.querySelector(".smartwoo-next")}_formatTime(e){if(isNaN(e)||e<0)return"0:00";let t=Math.floor(e%60);return`${Math.floor(e/60)}:${t<10?"0":""}${t}`}_escHtml(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}loadTrack(e){if(e<0){console.warn("Track index out of bounds:",e);return}e>=this.playlist.length&&this._reparsePlaylist(),this.currentTrackIndex=e;let t=this.playlist[this.currentTrackIndex];if(this.video.src=t.url,smartwooGetVideoThumbnail(t.url).then(e=>{this.video.poster=e}),this.currentTitleSpan&&(this.currentTitleSpan.textContent=this._escHtml(t.title)),this.currentArtistSpan&&(this.currentArtistSpan.textContent=this._escHtml(t.artist)),this.progressBar&&(this.progressBar.style.width="0%"),this.currentTimeSpan&&(this.currentTimeSpan.textContent="0:00"),this.durationSpan&&(this.durationSpan.textContent="0:00"),this.playlistItemsContainer){this.playlistItemsContainer.querySelectorAll(".smartwoo-video-playlist-item").forEach(e=>{e.classList.remove("is-active")});let i=this.playlistItemsContainer.querySelector(`[data-index="${this.currentTrackIndex}"]`);i&&i.classList.add("is-active")}this.video.load(),this.isPlaying&&this.video.play().catch(e=>console.warn("Autoplay prevented:",e))}togglePlayPause=()=>{this.isPlaying?(this.video.pause(),this.isPlaying=!1,this.playBtn&&this.playBtn.style.removeProperty("display"),this.pauseBtn&&this.pauseBtn.style.setProperty("display","none"),this.videoFrame&&this.videoFrame.classList.add("is-paused")):(this.video.play().catch(e=>console.error("Autoplay prevented:",e)),this.isPlaying=!0,this.playBtn&&this.playBtn.style.setProperty("display","none"),this.pauseBtn&&this.pauseBtn.style.removeProperty("display"),this.videoFrame&&this.videoFrame.classList.remove("is-paused"))};prev=()=>{let e=this.currentTrackIndex>0?this.currentTrackIndex-1:this.playlist.length-1;this.loadTrack(e)};next=()=>{let e=this.currentTrackIndex<this.playlist.length-1?this.currentTrackIndex+1:0;this.loadTrack(e)};mute=()=>{this.video.volume>0?(this.lastVolume=this.video.volume,this.video.volume=0):this.video.volume=this.lastVolume>0?this.lastVolume:.5,this.volumeSliderContainer&&this._updateVolumeBar({clientX:this.volumeSliderContainer.getBoundingClientRect().width*this.video.volume+this.volumeSliderContainer.getBoundingClientRect().left})};_updateSeekBar=e=>{if(!this.progressContainer||!this.progressBar||!this.currentTimeSpan)return;let t=this.progressContainer.getBoundingClientRect(),i=e.clientX||(e.touches&&e.touches[0]?e.touches[0].clientX:0),s=i-t.left;s=Math.max(0,Math.min(s,t.width));let r=s/t.width,a=r*this.video.duration;this.progressBar.style.width=`${100*r}%`,this.currentTimeSpan.textContent=this._formatTime(a),this.isSeeking&&(this.video.currentTime=a)};_showTimestampTooltip=e=>{if(!this.progressContainer||!this.tooltip)return;let t=this.progressContainer.getBoundingClientRect(),i=e.clientX||(e.touches&&e.touches[0]?e.touches[0].clientX:0),s=i-t.left;s=Math.max(0,Math.min(s,t.width));let r=s/t.width,a=r*this.video.duration;this.tooltip.textContent=this._formatTime(a),this.tooltip.style.left=`${s}px`,this.tooltip.style.display="block"};_hideTimestampTooltip=()=>{this.tooltip&&(this.tooltip.style.display="none")};_updateVolumeBar=e=>{if(!this.volumeSliderContainer||!this.volumeProgressBar)return;let t=this.volumeSliderContainer.getBoundingClientRect(),i=e.clientX||(e.touches&&e.touches[0]?e.touches[0].clientX:0),s=i-t.left,r=(s=Math.max(0,Math.min(s,t.width)))/t.width;isNaN(r)&&(r=this.lastVolume),this.video.volume=r,this.volumeProgressBar.style.width=`${100*r}%`,this.volumeScruber&&(this.volumeScruber.title=`${Math.round(100*r)}%`),this.volumeToggleIcon&&(0===this.video.volume?(this.volumeToggleIcon.classList.remove("dashicons-controls-volumeon"),this.volumeToggleIcon.classList.add("dashicons-controls-volumeoff"),this.volumeToggleIcon.title="Unmute"):(this.volumeToggleIcon.classList.remove("dashicons-controls-volumeoff"),this.volumeToggleIcon.classList.add("dashicons-controls-volumeon"),this.volumeToggleIcon.title="Mute")),localStorage.setItem("smartwoo-audio-volume",this.video.volume)};toggleFullScreen=e=>{this.isFullScreenMode?(document.exitFullscreen(),this.fullscreenToggle.classList.remove("dashicons","dashicons-fullscreen-exit-alt"),this.fullscreenToggle.classList.add("dashicons","dashicons-fullscreen-alt"),this.fullscreenToggle.title="Fullscreen mode"):(this.videoFrame.requestFullscreen().catch(e=>console.error("Fullscreen error:",e)),this.fullscreenToggle.classList.remove("dashicons","dashicons-fullscreen-alt"),this.fullscreenToggle.classList.add("dashicons","dashicons-fullscreen-exit-alt"),this.fullscreenToggle.title="Exit fullscreen")};resetControlVisibility=()=>{clearTimeout(this.controlsTimout),this.videoFrame&&this.videoFrame.classList.add("is-hovered"),this.videoFrame&&!this.video.paused&&this.videoFrame.style.removeProperty("cursor"),this.controlsTimout=setTimeout(this.hideControls,3e3)};hideControls=()=>{this.videoFrame&&this.videoFrame.classList.remove("is-hovered"),this.videoFrame&&!this.video.paused&&this.videoFrame.style.setProperty("cursor","none")};_showToast(e){this._toastEl||(this._toastEl=document.createElement("div"),this._toastEl.className="smartwoo-toast",this.videoFrame.prepend(this._toastEl)),this._toastEl.textContent=e,this._toastEl.classList.add("visible"),clearTimeout(this._toastTimeout),this._toastTimeout=setTimeout(()=>{this._toastEl.classList.remove("visible")},1e3)}_onLoadedMetadataCallback=()=>{this.durationSpan&&(this.durationSpan.textContent=this._formatTime(this.video.duration)),this.isPortriate=this.video.videoHeight>this.video.videoWidth,this.videoFrame&&this.videoFrame.classList.toggle("is-portriate",this.isPortriate),this.isPlaying||this.video.autoplay||(this.video.pause(),this.videoFrame&&this.videoFrame.classList.add("is-paused")),this.volumeSliderContainer&&this._updateVolumeBar({clientX:this.volumeSliderContainer.getBoundingClientRect().width*this.video.volume+this.volumeSliderContainer.getBoundingClientRect().left})};_syncProgress=()=>{if(!this.isSeeking&&this.progressBar){let e=this.video.currentTime/this.video.duration*100;this.progressBar.style.width=`${e}%`,this.currentTimeSpan&&(this.currentTimeSpan.textContent=this._formatTime(this.video.currentTime))}};_onClickPlaylistItem=e=>{let t=e.target.closest(".smartwoo-video-playlist-item");if(t){let i=parseInt(t.dataset.index);i!==this.currentTrackIndex&&this.loadTrack(i)}};_onEndedCallback=()=>{this.currentTrackIndex<this.playlist.length-1?this.loadTrack(this.currentTrackIndex+1):this.loadTrack(0)};_keyboardShortcuts=e=>{let t=e.key.toLowerCase();switch(t){case" ":case"k":this.togglePlayPause();break;case"arrowright":this.video.currentTime+=5;break;case"l":this.video.currentTime+=10;break;case"arrowleft":this.video.currentTime-=5;break;case"j":this.video.currentTime-=10;break;case"arrowup":this.video.volume=Math.min(1,this.video.volume+.1);break;case"arrowdown":this.video.volume=Math.max(0,this.video.volume-.1);break;case"m":this.volumeToggleIcon?.click();break;case"f":this.fullscreenToggle?.click();break;case"c":this._toggleCaptions?.();break;case"0":case"home":this.video.currentTime=0;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":let i=.1*parseInt(t);this.video.currentTime=this.video.duration*i;break;case".":this.video.paused&&(this.video.currentTime+=1/30);break;case",":this.video.paused&&(this.video.currentTime-=1/30);break;case">":this.video.playbackRate=Math.min(4,this.video.playbackRate+.25);break;case"<":this.video.playbackRate=Math.max(.25,this.video.playbackRate-.25);break;case"end":this.video.currentTime=this.video.duration}};_catch=e=>{console.error("Video error:",e),this.isPlaying&&(this.isPlaying=!1,this.playBtn&&this.playBtn.style.removeProperty("display"),this.pauseBtn&&this.pauseBtn.style.setProperty("display","none"),this.video.pause(),this.videoFrame&&this.videoFrame.classList.add("is-paused"))};togglePlaylist(){let e=this.assetVideoPlayer.querySelector(".smartwoo-video-player-right");e.classList.toggle("is-active")}_bindEvents(){this.playBtn.addEventListener("click",this.togglePlayPause),this.pauseBtn.addEventListener("click",this.togglePlayPause),this.video.addEventListener("loadedmetadata",this._onLoadedMetadataCallback),this.video.addEventListener("timeupdate",this._syncProgress),this.video.addEventListener("ended",this._onEndedCallback),this.video.addEventListener("error",this._catch),this.videoFrame.addEventListener("mousemove",this.resetControlVisibility),this.videoFrame.addEventListener("mouseleave",this.hideControls),this.progressContainer.addEventListener("mousemove",this._showTimestampTooltip),this.progressContainer.addEventListener("mouseleave",this._hideTimestampTooltip),this.prevBtn.addEventListener("click",this.prev),this.nextBtn.addEventListener("click",this.next),this.fullscreenToggle.addEventListener("click",this.toggleFullScreen),this.volumeToggleIcon.addEventListener("click",this.mute),this.playlistItemsContainer.addEventListener("click",this._onClickPlaylistItem),this.assetVideoPlayer.addEventListener("keydown",this._keyboardShortcuts),this.progressContainer.addEventListener("mousedown",e=>{this.isSeeking=!0,this._updateSeekBar(e),this.assetVideoPlayer.addEventListener("mousemove",this._updateSeekBar),this.assetVideoPlayer.addEventListener("mouseup",()=>{this.isSeeking=!1,this.assetVideoPlayer.removeEventListener("mousemove",this._updateSeekBar)},{once:!0})}),this.progressContainer.addEventListener("touchstart",e=>{this.isSeeking=!0,this._updateSeekBar(e)}),this.assetVideoPlayer.addEventListener("touchmove",e=>{this.isSeeking&&(this._updateSeekBar(e),e.preventDefault())},{passive:!1}),this.assetVideoPlayer.addEventListener("touchend",()=>{this.isSeeking=!1,this.isPlaying&&this.video.play()}),this.volumeSliderContainer.addEventListener("mousedown",e=>{this.isVolumeDragging=!0,this._updateVolumeBar(e),this.assetVideoPlayer.addEventListener("mousemove",this._updateVolumeBar),this.assetVideoPlayer.addEventListener("mouseup",()=>{this.isVolumeDragging=!1,this.assetVideoPlayer.removeEventListener("mousemove",this._updateVolumeBar)},{once:!0})}),this.volumeSliderContainer.addEventListener("touchstart",e=>{this.isVolumeDragging=!0,this._updateVolumeBar(e)}),this.assetVideoPlayer.addEventListener("touchmove",e=>{this.isVolumeDragging&&(this._updateVolumeBar(e),e.preventDefault())},{passive:!1}),this.assetVideoPlayer.addEventListener("touchend",()=>{this.isVolumeDragging=!1}),document.addEventListener("fullscreenchange",()=>{this.isFullScreenMode=!!document.fullscreenElement,this.videoFrame&&this.videoFrame.classList.toggle("is-fullscreen",this.isFullScreenMode),this.isFullScreenMode||(this.fullscreenToggle.classList.remove("dashicons","dashicons-fullscreen-exit-alt"),this.fullscreenToggle.classList.add("dashicons","dashicons-fullscreen-alt"),this.fullscreenToggle.title="Fullscreen mode")}),this.videoFrame.addEventListener("dblclick",e=>{let t=this.video.getBoundingClientRect(),i=e.clientX,s=t.width,r=i-t.left,a=s/3;r<a?(this.video.currentTime=Math.max(0,this.video.currentTime-10),this._showToast("-10s")):r>2*a?(this.video.currentTime=Math.min(this.video.duration,this.video.currentTime+10),this._showToast("+10s")):this.togglePlayPause()});let e=0;this.videoFrame.addEventListener("touchend",t=>{let i=Date.now(),s=i-e;if(s<300&&s>0){let r=t.changedTouches[0],a=this.video.getBoundingClientRect(),o=r.clientX,l=a.width,n=o-a.left,h=l/3;n<h?(this.video.currentTime=Math.max(0,this.video.currentTime-10),this._showToast("-10s")):n>2*h?(this.video.currentTime=Math.min(this.video.duration,this.video.currentTime+10),this._showToast("+10s")):this.togglePlayPause()}e=i}),this.playlistToggle.forEach(e=>e.addEventListener("click",this.togglePlaylist.bind(this)))}_initPlayer(){this.playlist.length>0?this.loadTrack(0):console.warn("Video playlist is empty."),this.video.removeAttribute("controls"),this.video.removeAttribute("controlist")}}class SmartWooGalleryPreview{constructor(e){if(!e){console.warn("SmartWooGalleryPreview: No gallery element provided.");return}this.galleryElement=e,this.previewOverlay=null,this.previewImageElement=null,this.items=[],this.currentIndex=0,this.collectImageData(),this.bindEvents()}collectImageData(){let e=this.galleryElement.querySelectorAll(".smartwoo-gallery-item img");this.items=Array.from(e).map((e,t)=>({src:e.src,alt:e.alt||"",index:t}))}bindEvents(){this.galleryElement.addEventListener("click",e=>{let t=e.target.closest(".smartwoo-gallery-item img");t&&(e.preventDefault(),this.currentIndex=this.items.findIndex(e=>e.src===t.src),this.openPreview())})}openPreview(){this.createOverlay(),this.updatePreviewImage(),this.bindPreviewEvents()}createOverlay(){if(this.previewOverlay)return;let e=document.createElement("div");e.className="smartwoo-gallery-preview-overlay",e.innerHTML=`
            <div class="smartwoo-gallery-preview-close">
                <span class="dashicons dashicons-no-alt"></span>
            </div>
            <button class="smartwoo-gallery-preview-nav smartwoo-prev-btn" type="button">
                <span class="dashicons dashicons-arrow-left-alt2"></span>
            </button>
            <div class="smartwoo-gallery-preview-content">
                <div class="smartwoo-preview-loader"></div>
                <img class="smartwoo-preview-image" src="" alt="">
            </div>
            <button class="smartwoo-gallery-preview-nav smartwoo-next-btn" type="button">
                <span class="dashicons dashicons-arrow-right-alt2"></span>
            </button>
        `,document.body.appendChild(e),this.previewOverlay=e,this.previewImageElement=this.previewOverlay.querySelector(".smartwoo-preview-image")}updatePreviewImage(){if(!this.previewOverlay||!this.previewImageElement||0===this.items.length)return;let e=this.previewOverlay.querySelector(".smartwoo-preview-loader"),t=this.previewOverlay.querySelector(".smartwoo-prev-btn"),i=this.previewOverlay.querySelector(".smartwoo-next-btn"),s=this.items[this.currentIndex];this.previewImageElement.style.opacity="0",e.style.display="block",this.previewImageElement.src=s.src,this.previewImageElement.alt=s.alt,this.previewImageElement.onload=()=>{e.style.display="none",this.previewImageElement.style.opacity="1"},this.previewImageElement.onerror=()=>{e.style.display="none",this.previewImageElement.style.opacity="1",console.error("Failed to load image:",s.src)},t.disabled=0===this.currentIndex,i.disabled=this.currentIndex===this.items.length-1}bindPreviewEvents(){let e=this.previewOverlay.querySelector(".smartwoo-prev-btn"),t=this.previewOverlay.querySelector(".smartwoo-next-btn"),i=this.previewOverlay.querySelector(".smartwoo-gallery-preview-close");e.addEventListener("click",()=>this.navigate(-1)),t.addEventListener("click",()=>this.navigate(1)),i.addEventListener("click",this.closePreview.bind(this)),this.previewOverlay.addEventListener("click",e=>{e.target===this.previewOverlay&&this.closePreview()}),this.previewImageElement&&this.previewImageElement.addEventListener("dblclick",this._toggleImageFullscreen.bind(this)),document.addEventListener("keydown",this.handleKeyPress.bind(this))}navigate(e){let t=this.currentIndex+e;t>=0&&t>=0&&t<this.items.length&&(this.currentIndex=t,this.updatePreviewImage())}handleKeyPress(e){"Escape"===e.key?this.closePreview():"ArrowLeft"===e.key||"ArrowUp"===e.key?this.navigate(-1):("ArrowRight"===e.key||"ArrowDown"===e.key)&&this.navigate(1)}_toggleImageFullscreen(){this.previewImageElement&&(document.fullscreenElement?document.exitFullscreen():this.previewImageElement.requestFullscreen().catch(e=>{console.error(`Error attempting to enable full-screen mode for image: ${e.message}`)}))}closePreview(){this.previewOverlay&&(document.fullscreenElement&&document.exitFullscreen(),this.previewOverlay.remove(),this.previewOverlay=null,this.previewImageElement=null,document.removeEventListener("keydown",this.handleKeyPress.bind(this)))}}const smartwooVideoThumbCache=new Map;async function smartwooGetVideoThumbnail(e){let t="data:image/svg+xml;base64,"+btoa(`
        <svg width="640" height="360" viewBox="0 0 640 360" xmlns="http://www.w3.org/2000/svg">
        <rect width="100%" height="100%" fill="#1e1e1e"/>
        <circle cx="320" cy="180" r="60" fill="#ffffff20" stroke="#ffffff60" stroke-width="4"/>
        <polygon points="310,150 350,180 310,210" fill="#ffffffb0"/>
        <text x="50%" y="85%" text-anchor="middle" font-family="Arial, sans-serif"
                font-size="16" fill="#cccccc">Video Thumbnail Unavailable</text>
        </svg>
    `),i=e.split("/").pop();if(smartwooVideoThumbCache.has(i))return smartwooVideoThumbCache.get(i);try{let s=await new Promise((t,i)=>{let s=document.createElement("video");s.crossOrigin="anonymous",s.preload="auto",s.muted=!0,s.playsInline=!0,s.src=e,s.addEventListener("error",()=>i("Video failed to load")),s.addEventListener("loadeddata",()=>{try{s.currentTime=Math.min(2,s.duration-1)}catch(e){i("Seeking failed: "+e.message)}}),s.addEventListener("seeked",()=>{try{let e=document.createElement("canvas");e.width=s.videoWidth,e.height=s.videoHeight;let r=e.getContext("2d");r.drawImage(s,0,0,e.width,e.height),e.toBlob(e=>{if(e){let s=URL.createObjectURL(e);t(s)}else i("Canvas to blob failed")},"image/jpeg",.92)}catch(a){i("Drawing thumbnail failed: "+a.message)}})});return smartwooVideoThumbCache.set(i,s),s}catch(r){return console.warn("Thumbnail generation failed:",r),t}}addEventListener("DOMContentLoaded",async()=>{let e=document.querySelectorAll(".smartwoo-audio-playlist"),t=document.querySelectorAll(".smartwoo-video-player-container"),i=document.querySelectorAll(".smartwoo-video-playlist-item_image"),s=document.querySelectorAll(".smartwoo-gallery");e.forEach(e=>{new SmartwooAudioPlayer(e)}),t.forEach(async e=>{new SmartwooVideoPlayer(e)}),i.forEach(e=>{e.src=e.src||"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2264%22%20height%3D%2248%22%20viewBox%3D%220%200%2064%2048%22%3E%3Cdefs%3E%3ClinearGradient%20id%3D%22g%22%20x1%3D%220%25%22%20y1%3D%220%25%22%20x2%3D%22100%25%22%20y2%3D%22100%25%22%3E%3Cstop%20offset%3D%220%25%22%20stop-color%3D%22%2366ccff%22/%3E%3Cstop%20offset%3D%22100%25%22%20stop-color%3D%22%236600ff%22/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect%20x%3D%222%22%20y%3D%222%22%20width%3D%2260%22%20height%3D%2244%22%20rx%3D%229%22%20fill%3D%22url(%23g)%22%20stroke%3D%22%23fff%22%20stroke-width%3D%222%22/%3E%3Cpath%20d%3D%22M24%2016l16%208-16%208z%22%20fill%3D%22%23fff%22/%3E%3C/svg%3E"}),s.forEach(e=>{new SmartWooGalleryPreview(e)})});