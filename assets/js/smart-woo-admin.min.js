function renderTable(e,t,a,n,o,r){let s={},i=document.querySelector(".sw-admin-dash-body"),l=document.querySelector(".sw-search-container");smartwooRemoveTable(),totalItems=t.length,addPaginationControls(l,n,o,totalItems,r);let c=document.createElement("table");c.classList.add("sw-table","widefat","striped");let d=document.createElement("thead"),u=document.createElement("tr"),m=document.createElement("th"),p=document.createElement("input");p.type="checkbox",p.addEventListener("change",(function(){v.querySelectorAll('input[type="checkbox"]').forEach((e=>{e.checked=this.checked,s[e.name]=this.checked})),w()})),m.appendChild(p),u.appendChild(m),e.forEach((e=>{let t=document.createElement("th");t.textContent=e,u.appendChild(t)})),d.appendChild(u),c.appendChild(d);let v=document.createElement("tbody");if(0===t.length){let t=document.createElement("tr"),a=document.createElement("td");a.colSpan=e.length+1,a.textContent="No service found.",a.classList.add("sw-not-found"),t.appendChild(a),v.appendChild(t)}else t.forEach(((e,t)=>{let n=document.createElement("tr"),o=document.createElement("td"),r=document.createElement("input");r.type="checkbox",r.name=a[t],s[r.name]&&(r.checked=!0),r.addEventListener("change",(function(){s[this.name]=this.checked,this.checked||(p.checked=!1),Array.from(v.querySelectorAll('input[type="checkbox"]')).every((e=>e.checked))&&(p.checked=!0),w()})),o.appendChild(r),n.appendChild(o),e.forEach(((e,t)=>{let a=document.createElement("td");a.textContent=e,1===t&&(a.classList.add("service-id-column"),a.style.cursor="pointer",a.setAttribute("title","View service details"),a.addEventListener("click",(function(){smartwoo_service_admin_view(e)}))),n.appendChild(a)})),v.appendChild(n)}));function w(){let e=[];if(v.querySelectorAll('input[type="checkbox"]:checked').forEach((t=>e.push(t.name))),e.length>0)smartwooShowActionDialog(e);else{let e=document.querySelector(".sw-action-container");e&&e.remove()}}c.appendChild(v),c.style.display="none",i.appendChild(c),jQuery(c).fadeIn("slow"),addPaginationControls(i,n,o,totalItems,r)}let addedClearBtn=!1;function addPaginationControls(e,t,a,n,o){let r=document.createElement("div");r.classList.add("sw-pagination-buttons"),r.style.float="right";let s=document.createElement("p");if(s.textContent=`${n} items`,r.appendChild(s),a>1){let e=a-1,t=document.createElement("a");t.classList.add("sw-pagination-button");let n=document.createElement("button");n.innerHTML='<span class="dashicons dashicons-arrow-left-alt2"></span>',t.appendChild(n),t.addEventListener("click",(function(t){t.preventDefault(),fetchDashboardData(o,{paged:e,limit:25})})),r.appendChild(t)}let i=document.createElement("p");if(i.textContent=`${a} of ${t}`,r.appendChild(i),a<t){let e=a+1,t=document.createElement("a");t.classList.add("sw-pagination-button");let n=document.createElement("button");n.innerHTML='<span class="dashicons dashicons-arrow-right-alt2"></span>',t.appendChild(n),t.addEventListener("click",(function(t){t.preventDefault(),fetchDashboardData(o,{paged:e,limit:25})})),r.appendChild(t)}if(e.appendChild(r),!addedClearBtn){r.style.float="",r.style.marginTop="0px";let t=document.createElement("span");t.classList.add("dashicons","dashicons-dismiss"),t.style.color="#c48f00",t.style.marginRight="20px",t.style.fontSize="23px",t.style.cursor="pointer",t.setAttribute("title","Restore dashboard"),e.appendChild(t),addedClearBtn=!0;let a=()=>{let e=document.getElementById("dashboardBtn");addedClearBtn=!1,t.remove(),e.click()};document.addEventListener("dashboardtableRemoved",(()=>{t.remove(),addedClearBtn=!1})),t.addEventListener("click",a)}}function smartwoo_service_admin_view(e){let t=new URL(smartwoo_admin_vars.sw_admin_page);t.searchParams.set("tab","view-service"),t.searchParams.set("service_id",e),window.location.href=t.href}function smartwooRemoveTable(){let e=document.querySelector(".sw-table"),t=document.querySelectorAll(".sw-pagination-buttons");e&&(e.remove(),t&&t.forEach((e=>{e.remove()})),document.dispatchEvent(new CustomEvent("dashboardtableRemoved")))}function smartwooPostBulkAction(e,t=[]){if("delete"===e){if(!confirm("Warning: You are about to delete the selected service"+(t.length>1?"s":"")+", along with all related invoices and assets. Click OK to confirm."))return}showLoadingIndicator(),jQuery.ajax({type:"POST",url:smartwoo_admin_vars.ajax_url,data:{action:"smartwoo_dashboard_bulk_action",service_ids:t,real_action:e,security:smartwoo_admin_vars.security},success:function(e){e.success?(showNotification(e.data.message),setTimeout((()=>{window.location.reload()}),2e3)):showNotification("Oops! "+e.data.message)},error:function(e,t,a){showNotification("An error occured, please inspect console.")},complete:function(){let e=document.querySelector(".sw-action-container");e&&e.remove(),hideLoadingIndicator()}})}function smartwooShowActionDialog(e){let t=document.querySelector(".sw-action-container");t&&t.remove();const a=document.createElement("div");a.classList.add("sw-action-container"),a.innerHTML=`\n      <select id="sw-action-select" name="dash_bulk_action">\n        <option selected>Choose Action</option>\n        <option value="auto_calc">Auto Calculate</option>\n        <option value="Active">Activate</option>\n        <option value="Active (NR)">Disable Renewal</option>\n        <option value="Suspended">Suspend Service</option>\n        <option value="Cancelled">Cancel Service</option>\n        <option value="Due for Renewal">Due for Renewal</option>\n        <option value="Expired">Expired</option>\n        <option value="delete">Delete</option>\n      </select>\n      <input type="hidden" name="service_ids" value="${e}"/>\n    `;document.querySelector(".sw-table").prepend(a),jQuery(".sw-action-container").fadeIn().css("display","flex"),a.addEventListener("change",(()=>{const t=a.querySelector("select").value;let n=document.querySelector(".sw-action-btn");n&&n.remove();let o=document.createElement("button");o.classList.add("sw-action-btn"),o.textContent="Apply Action","Choose Action"!==t&&(a.append(o),jQuery(o).fadeIn()),o&&o.addEventListener("click",(()=>{smartwooPostBulkAction(t,e)}))}))}let fetchIntervals={};function fetchServiceCount(e,t,a){let n=document.querySelectorAll(".sw-dash-content");return jQuery.ajax({type:"GET",url:smartwoo_admin_vars.ajax_url,data:{action:"smartwoo_dashboard",real_action:t,security:smartwoo_admin_vars.security},success:function(o){if(o.success){smartwoo_clear_dash_content(e);let r=document.createElement("div"),s=document.createElement("h2"),i=document.createElement("span");r.classList.add("sw-dash-count"),s.textContent=o.data[t],i.textContent=a,r.appendChild(s),r.appendChild(i),n[e].append(r),jQuery(".sw-dash-count").fadeIn().css("display","flex")}else smartwooAddRetryBtn(e,t,a)},error:function(n){let o="Error fetching data: ";n.responseJSON&&n.responseJSON.data&&n.responseJSON.data.message?o+=n.responseJSON.data.message:n.responseText?o+=n.responseText:o+=n,smartwooAddRetryBtn(e,t,a)},complete:function(){fetchIntervals[e]&&clearInterval(fetchIntervals[e]),fetchIntervals[e]=setInterval((()=>{fetchServiceCount(e,t,a)}),9e5)}})}function smartwooAddRetryBtn(e,t,a){let n=document.querySelectorAll(".sw-dash-content");smartwoo_clear_dash_content(e);let o=document.createElement("div");o.classList.add("sw-dash-count");let r=document.createElement("h3");r.textContent="Error Occurred",o.append(r);let s=document.createElement("button");s.classList.add("sw-red-button"),s.textContent="retry",s.setAttribute("onclick",`fetchServiceCount(${e}, '${t}', '${a}')`),o.append(s),n[e].append(o),jQuery(".sw-dash-count").fadeIn().css("display","flex"),s.addEventListener("click",(()=>{s.style.cursor="progress"}))}function smartwoo_clear_dash_content(e){let t=document.querySelectorAll(".sw-dash-content");t&&(t[e].innerHTML="")}function fetchDashboardData(e,t={}){let a=document.querySelector(".sw-dash-content-container"),n=smartWooAddSpinner("swloader",!0);switch(e){case 0:realAction="all_services_table";break;case 1:realAction="all_pending_services_table";break;case 2:realAction="all_active_services_table";break;case 3:realAction="all_active_nr_services_table";break;case 4:realAction="all_due_services_table";break;case 5:realAction="all_on_grace_services_table";break;case 6:realAction="all_expired_services_table";break;case 7:realAction="all_cancelled_services_table";break;case 8:realAction="all_suspended_services_table";break;default:realAction="sw_search"}if("all_pending_services_table"===realAction)return void(window.location.href=smartwoo_admin_vars.admin_order_page);let o=t.limit||10,r=t.paged||1,s=new URL(smartwoo_admin_vars.ajax_url);s.searchParams.set("action","smartwoo_dashboard"),s.searchParams.set("security",smartwoo_admin_vars.security),s.searchParams.set("real_action",realAction),s.searchParams.set("limit",o),s.searchParams.set("paged",r),"sw_search"===realAction&&s.searchParams.set("search_term",t.search),fetch(s).then((e=>{if(e.ok)return e.json()})).then((t=>{if(t.success){let a=t.data.all_services_table;renderTable(a.table_header,a.table_body,a.row_names,a.total_pages,a.current_page,e)}})).catch((e=>{e.responseJSON&&e.responseJSON.data&&e.responseJSON.data.message?e.responseJSON.data.message:e.responseText&&e.responseText})).finally((()=>{a&&(a.style.display="none"),smartWooRemoveSpinner(n)}))}function smartwooDeleteInvoice(e){confirm("Do you realy want to delete this invoice? This action cannot be reversed!")&&(spinner=smartWooAddSpinner("swloader",!0),jQuery.ajax({type:"POST",url:smartwoo_admin_vars.ajax_url,data:{action:"delete_invoice",invoice_id:e,security:smartwoo_admin_vars.security},success:function(e){e.success?(alert(e.data.message),window.location.href=smartwoo_admin_vars.admin_invoice_page):alert(e.data.message)},error:function(e){},complete:function(){smartWooRemoveSpinner(spinner)}}))}function smartwooProBntAction(e){let t=document.querySelector(".sw-pro-sell-content");t.innerHTML="";let a=document.createElement("span");a.className="dashicons dashicons-yes-alt";let n=document.createElement("h2");n.textContent="dismiss_fornow"===e?"Dismissed.":"Reminder has been set.",t.append(a),t.append(n),setInterval((()=>a.classList.toggle("loaded")),500),setTimeout((()=>{jQuery(t.parentElement).fadeOut((()=>t.remove()))}),2e3);let o=new URL(smartwoo_admin_vars.ajax_url);o.searchParams.set("action","smartwoo_pro_button_action"),o.searchParams.set("security",smartwoo_admin_vars.security),o.searchParams.set("real_action",e),fetch(o).then((e=>{if(!e.ok)throw new Error(e.text());return e.json()})).then((e=>{e.success||window.location.reload()})).catch((e=>{showNotification("Error occured"),window.location.reload()}))}function smartwooDeleteProduct(e){confirm("Are you sure you want to permanently delete this product? This action cannot be reversed!")&&(spinner=smartWooAddSpinner("swloader",!0),jQuery.ajax({type:"POST",url:smartwoo_admin_vars.ajax_url,data:{action:"smartwoo_delete_product",product_id:e,security:smartwoo_admin_vars.security},success:function(e){e.success?(alert(e.data.message),window.location.href=smartwoo_admin_vars.sw_product_page):alert(e.data.message)},error:function(e){},complete:function(){smartWooRemoveSpinner(spinner)}}))}function smartwooDeleteService(e){confirm("Are you sure you want to delete this service? All invoices and assets alocated to it will be lost forever.")&&(spinner=smartWooAddSpinner("sw-admin-spinner",!0),jQuery.ajax({type:"POST",url:smartwoo_admin_vars.ajax_url,data:{action:"smartwoo_delete_service",service_id:e,security:smartwoo_admin_vars.security},success:function(e){e.success?(alert(e.data.message),window.location.href=smartwoo_admin_vars.sw_admin_page):alert(e.data.message)},error:function(e){alert("Error deleting service:",e)},complete:function(){smartWooRemoveSpinner(spinner)}}))}function smartwoo_pro_ad(e,t){let a=document.querySelector(".sw-pro-div");a&&jQuery(a).fadeOut("fast",(()=>{a.remove()}));let n=document.querySelector(".smartwoo-settings-form")??document.querySelector("#pro-target"),o=document.createElement("div");o.classList.add("sw-pro-div");let r=document.createElement("span");r.classList.add("dashicons","dashicons-dismiss"),r.setAttribute("title","close"),r.style.position="absolute",r.style.right="5px",r.style.top="2px",r.style.color="red",r.style.cursor="pointer";let s=document.createElement("h2");s.textContent=e;let i=document.createElement("div");i.classList.add("sw-pro-body"),i.innerHTML=t;let l=document.createElement("span");l.classList.add("sw-pro-action-btn"),l.textContent="Activate Pro Feature",o.append(s),o.append(r),o.append(i),o.append(l),n.prepend(o),jQuery(o).fadeIn("slow").css("display","flex"),r.addEventListener("click",(()=>{jQuery(o).fadeOut("fast",(()=>{o.remove()}))})),l.addEventListener("click",(()=>{window.open(smartwoo_admin_vars.smartwoo_pro_page,"_blank")}))}async function smartwooPromptGuestInvoiceData(e){return new Promise((t=>{let a={first_name:"",last_name:"",billing_email:"",billing_company:"",billing_phone:"",billing_address:""},n=document.createElement("div"),o=`<span class="smartwoo-remove dashicons dashicons-no" title="Close"></span>\n            <h2>${e}</h2>\n            <div class="sw-guest-name-row">\n                <input type="text" name="first_name" placeholder="First Name" id="first_name"/>\n                <input type="text" name="last_name" placeholder="Last Name" id="last_name"/>\n            </div>\n            <div class="sw-guest-other-row">\n                <input type="text" name="billing_email" placeholder="Billing Email" id="billing_email"/>\n                <input type="text" name="billing_company" placeholder="Billing Company" id="billing_company"/>\n                <input type="text" name="billing_phone" placeholder="Billing Phone" id="billing_phone">\n                <input type="text" name="billing_address" placeholder="Full address" id="billing_address"/>\n                <button class="sw-blue-button" style="width: 80%; margin: 10px;">Add Guest</button>\n\n            </div>\n        `;n.classList.add("sw-guest-invoice-container"),n.innerHTML=o;let r=document.querySelector("#smartwooInvoiceForm").parentElement,s=document.querySelector("#smartwooInvoiceForm");r.insertBefore(n,s),n.querySelector(".smartwoo-remove").addEventListener("click",(()=>{n.remove(),t(!1)})),n.querySelector(".sw-blue-button").addEventListener("click",(e=>{e.preventDefault(),a.first_name=n.querySelector('input[name="first_name"]').value,a.last_name=n.querySelector('input[name="last_name"]').value,a.billing_address=n.querySelector('input[name="billing_address"]').value,a.billing_phone=n.querySelector('input[name="billing_phone"]').value,a.billing_company=n.querySelector('input[name="billing_company"]').value,a.billing_email=n.querySelector('input[name="billing_email"]').value,t(a),n.remove()}))}))}function smartwooPostswTableBulkAction(e={hook_name:"",value:""},t=[]){if("delete"===e.value){if(!confirm(`You are about to delete the selected item${t.length>1?"s":""}! click ok to confirm.`))return}let a=smartWooAddSpinner("swloader",!0);url=new URL(smartwoo_admin_vars.ajax_url),url.searchParams.append("action","smartwoo_table_bulk_action");let n=new FormData;n.append("payload",t),n.append("security",smartwoo_admin_vars.security),n.append("real_action",e.hook_name),n.append("selected_action",e.value),fetch(url,{method:"POST",body:n}).then((e=>{if(!e.ok)throw showNotification(`An error occured: [${e.statusText}]`,6e3),new Error("Network response was not ok");return e.json()})).then((e=>{e.success?(showNotification(e.data.message,3e3),setTimeout((()=>{window.location.reload()}),3e3)):showNotification(e.data.message,6e3)})).catch((e=>{})).finally((()=>{smartWooRemoveSpinner(a)}))}function smartwooBulkActionForTable(e={options:[],selectedRows:[],hookName:hookName},t){let a=document.querySelector(".sw-action-container"),n=t instanceof HTMLElement?t:document.querySelector(".sw-table");a&&a.remove();const o=document.createElement("div");o.classList.add("sw-action-container");let r=document.createElement("select");r.id="sw-action-select",r.name="dash_bulk_action",r.innerHTML='<option value="">Choose Action</option>',e.options.forEach((e=>{optElement=document.createElement("option"),optElement.value=e.value,optElement.text=e.text,r.appendChild(optElement)}));let s=e.selectedRows,i=document.createElement("button");return i.classList.add("sw-action-btn"),i.textContent="Apply Action",o.append(r),n.prepend(o),jQuery(o).fadeIn().css("display","flex"),r.addEventListener("change",(()=>{r.value?(o.append(i),jQuery(i).fadeIn()):i.remove()})),i.addEventListener("click",(()=>{smartwooPostswTableBulkAction({hook_name:e.hookName,value:r.value},s)})),o}function smartwooopenWPMediaOnClick(e){e.preventDefault();let t,a=e.target.parentElement,n=a.querySelector("[smartwoo-media-id]"),o=a.querySelector("[smartwoo-media-url]");t||(t=wp.media({title:"Select File",button:{text:"Insert"},multiple:!1}),t.on("select",(()=>{let e=t.state().get("selection").first().toJSON();n&&(n.value="",n.value=e.id),o&&(o.value="",o.value=e.url)}))),t.open()}function smartwooDatesInputsHandler(){const e=e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`;let t=document.querySelector("#sw_start_date"),a=document.querySelector("#sw_next_payment_date"),n=document.querySelector("#sw_end_date"),o=document.querySelector("#sw_billing_cycle");o&&t&&a&&n&&o.addEventListener("change",(()=>{if(!t.value.length)return t.reportValidity(),void(o.value="");if(!o.value)return;let r=new Date(t.value);if(isNaN(r.getTime()))return void showNotification("Invalid start date",3e3);let s,i=new Date(r);switch(o.value){case"Weekly":i.setDate(i.getDate()+7);break;case"Monthly":i.setMonth(i.getMonth()+1);break;case"Quarterly":i.setMonth(i.getMonth()+3);break;case"Semiannually":i.setMonth(i.getMonth()+6);break;case"Yearly":i.setFullYear(i.getFullYear()+1);break;default:return void showNotification("Invalid billing cycle",3e3)}let l=smartwoo_admin_vars.global_nextpay_date||{operator:"-",number:7,unit:"days"},c=l.operator||"-",d=parseInt(l.number)||7,u=l.unit||"days";switch(s=new Date(i),u){case"days":s.setDate(s.getDate()+("-"===c?-d:d));break;case"weeks":s.setDate(s.getDate()+("-"===c?7*-d:7*d));break;case"months":s.setMonth(s.getMonth()+("-"===c?-d:d));break;case"years":s.setFullYear(s.getFullYear()+("-"===c?-d:d));break;default:}n.value=e(i),a.value=e(s),n.dispatchEvent(new Event("input",{bubbles:!0})),a.dispatchEvent(new Event("input",{bubbles:!0}))}));let r=document.querySelectorAll("#sw_start_date, #sw_next_payment_date, #sw_end_date, #date_on_sale_from, #date_on_sale_to, #invoice_due_date, #smartwoo_update_creation_date");r.length&&r.forEach((e=>{let t={dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,showButtonPanel:!0,closeText:"Done",currentText:"Today",nextText:"Next",prevText:"Previous",onSelect:function(){e.dispatchEvent(new Event("input",{bubbles:!0}))}};"Invoices"===smartwoo_admin_vars.currentScreen&&jQuery(e).on("focus",(function(){requestAnimationFrame((()=>{const e=jQuery(this),t=e.offset(),a=e.outerHeight();jQuery("#ui-datepicker-div").css({top:t.top+a+"px",left:t.left+"px","z-index":9999})}))})),e.getAttribute("smartwoo-datetime-picker")?jQuery(e).datetimepicker({...t,timeFormat:"HH:mm:ss"}):jQuery(e).datepicker(t)}))}function smartwooInvoiceEditorItemCalculator(e){const t=document.getElementById("product_dropdown_json"),a=document.querySelector("#swInvoiceItemsBody"),n=document.querySelector("input#subtotal-value"),o=document.querySelector("input#grandTotal");let r=document.querySelector("#smartwoo-no-pro-add-item-btn");if(!t)return;const s=t.getAttribute("data-json"),i=JSON.parse(s);let l=!1;const c=()=>{let e=a.querySelectorAll("tr"),t=0;e.forEach((e=>{const a=e.querySelector("input.sw-invoice-editor-quantity-input"),n=e.querySelector("input.sw-invoice-editor-unit-price-input"),o=e.querySelector(".sw-invoice-editor-line-total-input");if(a&&n&&o){let e=(parseFloat(a.value)||0)*(parseFloat(n.value)||0);o.textContent=e.toFixed(2),t+=e}})),n&&(n.value=t.toFixed(2)),o&&(o.value=t.toFixed(2))},d=t=>{t.preventDefault(),t.target.removeEventListener("click",d),jQuery(t.target.closest("tr")).fadeOut("fast",(()=>{t.target.closest("tr").remove(),0===a.querySelectorAll("tr").length&&(e.value="",a.innerHTML='<tr><td colspan="4" class="sw-not-found">No items</td></tr>',l=!1),c()}))};r&&r.addEventListener("click",(e=>{e.preventDefault(),smartwoo_pro_ad("Add Custom Items","Add unlimited items to your invoice, track payment logs, make quotes with Smart Woo Pro")})),a.querySelectorAll("input.sw-invoice-editor-quantity-input, input.sw-invoice-editor-unit-price-input").forEach((e=>{e.addEventListener("input",c)})),a.querySelectorAll(".sw-remove").forEach((e=>{e.addEventListener("click",d)})),c(),e.addEventListener("change",(e=>{a.innerHTML="",l=!1;const t=e.target.value;if(i[t]){const e=i[t],n=`\n\t\t\t<tr>\n\t\t\t\t<td><input type="text" class="sw-invoice-editor-item-name-input" value="${e.name}" id="${t}" autocomplete="off"></td>\n\t\t\t\t<td><input type="number" class="sw-invoice-editor-quantity-input" value="1" step="1" min="1" disabled></td>\n\t\t\t\t<td><input type="number" class="sw-invoice-editor-unit-price-input" value="${e.price}" step="0.01" disabled></td>\n\t\t\t\t<td class="sw-invoice-editor-line-total-input">${parseFloat(e.price).toFixed(2)}</td>\n\t\t\t\t<td><span class="dashicons dashicons-trash sw-remove" title="Remove item" style="cursor: pointer; color: red;"></span></td>\n\t\t\t</tr>\n\t\t\t${e.sign_up_fee?`\n\t\t\t<tr>\n\t\t\t\t<td><input type="text" class="sw-invoice-editor-item-name-input" value="Sign-up Fee" id="${String(Math.random()).replace("0.","")}" autocomplete="off"></td>\n\t\t\t\t<td><input type="number" class="sw-invoice-editor-quantity-input" value="1" step="1" min="1" disabled></td>\n\t\t\t\t<td><input type="number" name="fee" class="sw-invoice-editor-unit-price-input" value="${e.sign_up_fee}" step="0.01"></td>\n\t\t\t\t<td class="sw-invoice-editor-line-total-input">${parseFloat(e.sign_up_fee).toFixed(2)}</td>\n\t\t\t\t<td><span class="dashicons dashicons-trash sw-remove" title="Remove item" style="cursor: pointer; color: red;"></span></td>\n\t\t\t</tr>`:""}\n\t\t\t`;a.innerHTML=n,a.querySelectorAll(".sw-remove").forEach((e=>{e.addEventListener("click",d)})),a.querySelectorAll("input.sw-invoice-editor-quantity-input, input.sw-invoice-editor-unit-price-input").forEach((e=>{e.addEventListener("input",c)})),l=!0,c()}}))}document.addEventListener("DOMContentLoaded",(()=>{smartwooDatesInputsHandler();let e=document.querySelector(".sw-dash-content-container"),t=document.querySelectorAll(".sw-dash-content"),a=document.getElementById("dashOrderBtn"),n=document.getElementById("dashAddNew"),o=document.getElementById("dashInvoicesBtn"),r=document.getElementById("dashProductBtn"),s=document.getElementById("dashSettingsBtn"),i=document.querySelectorAll(".sw-upgrade-to-pro"),l=document.getElementById("sw_service_search"),c=document.getElementById("swSearchBtn");const d=document.getElementById("search-notification");let u=document.querySelector(".sw-admin-menu-icon"),m=document.querySelectorAll(".delete-invoice-button"),p=document.querySelectorAll(".sw-delete-product"),v=document.querySelector(".delete-service-button"),w=document.querySelector(".sw-admin-dash-header"),h=document.querySelectorAll(".sw-edit-mail-nopro"),y=document.querySelectorAll(".sw-checkboxes"),f=document.getElementById("sw-hide"),_=document.querySelectorAll(".smartwoo-prevent-default"),g=document.querySelector("#smartwoo-pro-remind-later"),b=document.querySelector("#smartwoo-pro-dismiss-fornow"),E=document.querySelector("#user_data"),S=document.querySelector("#smartwooInvoiceForm"),L=document.querySelectorAll(".sw-toggle-btn"),k=document.querySelectorAll(".smartwoo-admin-invoice-action-div button"),q=document.querySelector(".smartwoo-admin-invoice-action-div"),x=document.querySelector(".smartwoo-admin-invoice-actions"),A=document.querySelector(".sw-table"),C=document.querySelector("#grace_period"),T=document.querySelector("#upload_sw_product_image"),D=document.querySelector("#add-product-galleryBtn"),j=document.querySelector(".sw-product-data-tabs-menu"),I=document.querySelector("#sw-product-form"),P=document.querySelector("#is-smartwoo-downloadable"),N=document.querySelectorAll(".swremove-field"),B=document.querySelectorAll(".sw-view-details-service-product, .admin-view-service-invoices-items, .sw-admin-subinfo, .sw-admin-client-billing-info-tab, .sw-admin-client-info-essentials, .sw-admin-client-info-pro-data, .sw-admin-client-service-invoice-pro-sell"),O=document.querySelector("#smartwooServiceUserDropdown");const M=document.querySelector("#smartwooServiceForm");let R=document.getElementById("resetFastCheckoutOptions"),$=document.querySelector("#auto-renew-btn"),Q=document.querySelector("#service_products"),W=document.querySelector(".smartwoo-admin-knowledgebase"),F=document.querySelector(".sw-dash-pro-sell-bg"),H=document.querySelector("#smartwoo-dashboard-switcher");if(H&&H.addEventListener("click",(e=>{e.target.disabled=!0;const t=smartWooAddSpinner("swloader",!0),a=new URL(smartwoo_admin_vars.ajax_url);a.searchParams.set("action","smartwoo_toggle_use_new_admin_dash"),a.searchParams.set("security",smartwoo_admin_vars.security),fetch(a.href).then((e=>{if(!e.ok)throw new Error("Something went wrong!")})).then((()=>window.location.reload())).catch((e=>showNotification(e.message,1e4))).finally((()=>smartWooRemoveSpinner(t)),e.target.disabled=!1)})),F&&setTimeout((()=>{jQuery(F).fadeIn()}),5e3),document.addEventListener("click",(e=>{if(!e.target.closest(".smartwoo-linked-table-row"))return;if(e.target.closest(".smartwoo-options-dots, input, select"))return;if(window.getSelection().toString().length>0)return;const t=e.target.closest("tr")?.dataset?.url;t&&(e.ctrlKey||e.metaKey?window.open(t,"_blank"):window.location.href=t)})),P){let e=document.querySelector("#add-field");P.addEventListener("change",(e=>{e.preventDefault(),e.target.checked?(jQuery(".sw-assets-div").fadeIn().css("display","flex"),jQuery(".sw-product-download-field-container, .sw-service-assets-downloads-container, .sw-service-additional-assets-container").fadeIn(),jQuery(".sw-product-download-fields").fadeIn(),jQuery("#add-field").fadeIn(),jQuery(".sw-no-download-text").hide()):(jQuery(".sw-assets-div").fadeOut(),jQuery(".sw-product-download-field-container, .sw-service-assets-downloads-container, .sw-service-additional-assets-container").fadeOut(),jQuery(".sw-product-download-fields").fadeOut(),jQuery("#add-field").fadeOut(),jQuery(".sw-no-download-text").fadeIn(1e3))})),document.querySelectorAll(".smartwooOpenWpMedia").forEach((e=>{e.addEventListener("click",smartwooopenWPMediaOnClick)})),e.addEventListener("click",(t=>{t.preventDefault();let a=document.querySelector(".sw-product-download-field-container");a=a||document.querySelector(".sw-service-assets-downloads-container");let n=document.createElement("div"),o=document.createElement("span");n.classList.add("sw-product-download-fields"),n.innerHTML='<input type="text" class="sw-filename" name="sw_downloadable_file_names[]" placeholder="File Name"/>\n                <input type="url" class="fileUrl" name="sw_downloadable_file_urls[]" smartwoo-media-url placeholder="File URL" />\n                <button class="smartwooOpenWpMedia button">Choose file</button>\n            ',o.classList.add("dashicons","dashicons-dismiss"),o.style.color="red",o.style.cursor="pointer",o.setAttribute("title","remove"),n.appendChild(o),a.insertBefore(n,e),o.addEventListener("click",(e=>{e.preventDefault(),jQuery(n).fadeOut(),setTimeout((()=>{n.remove()}),1e3)})),n.querySelector(".smartwooOpenWpMedia").addEventListener("click",smartwooopenWPMediaOnClick)}))}if(e){for(let a=0;a<8;a++)e.append(t[0].cloneNode(!0));const a=[fetchServiceCount(0,"total_services","All Services"),fetchServiceCount(1,"total_pending_services","Pending Service Orders"),fetchServiceCount(2,"total_active_services","Active Services"),fetchServiceCount(3,"total_active_nr_services","Active No Renewal"),fetchServiceCount(4,"total_due_services","Due for Renewal"),fetchServiceCount(5,"total_on_grace_services","Grace Period"),fetchServiceCount(6,"total_expired_services","Expired Services"),fetchServiceCount(7,"total_cancelled_services","Cancelled Services"),fetchServiceCount(8,"total_suspended_services","Suspended Services")];Promise.allSettled(a).finally((()=>{document.dispatchEvent(new CustomEvent("SmartWooDashboardLoaded"))}))}if(n&&n.addEventListener("click",(()=>{window.location.href=smartwoo_admin_vars.new_service_page})),a&&a.addEventListener("click",(()=>{window.location.href=smartwoo_admin_vars.admin_order_page})),o&&o.addEventListener("click",(()=>{window.location.href=smartwoo_admin_vars.admin_invoice_page})),r&&r.addEventListener("click",(()=>{window.location.href=smartwoo_admin_vars.sw_product_page})),s&&s.addEventListener("click",(()=>{window.location.href=smartwoo_admin_vars.sw_options_page})),i&&i.forEach((e=>{e.addEventListener("click",(()=>{window.open(smartwoo_admin_vars.smartwoo_pro_page,"_blank")}))})),l&&c&&d&&(l.addEventListener("input",(()=>{0==l.value.trim().length?c.style.cursor="not-allowed":(c.style.cursor="pointer",d.style.display="none")})),c.addEventListener("click",(()=>{const e=l.value.trim();e.length>0?(fetchDashboardData("sw_search",{search:e}),d.style.display="none"):(d.textContent="Search field cannot be empty.",d.style.display="block"),d.addEventListener("click",(()=>{d.style.display="none"}))}))),u){let e=document.querySelector(".sw-admin-dash-nav");u.addEventListener("click",(()=>{e.classList.toggle("show")}))}if(m&&0!==m.length&&m.forEach((e=>{e.addEventListener("click",(()=>{smartwooDeleteInvoice(e.getAttribute("data-invoice-id"))}))})),p&&0!==p.length&&p.forEach((e=>{let t=e.getAttribute("data-product-id");e.addEventListener("click",(()=>{smartwooDeleteProduct(t)}))})),v){let e=v.parentElement.querySelectorAll("a button"),t=v.getAttribute("service-id");e.forEach((e=>{e.classList.add("sw-icon-button-admin")})),v.classList.add("sw-icon-button-admin"),v.addEventListener("click",(()=>{smartwooDeleteService(t)}))}if(w&&document.addEventListener("scroll",(()=>{if(window.scrollY>0?w.classList.add("is-scrolled"):w.classList.remove("is-scrolled"),window.matchMedia("( min-width: 19px) and (max-width: 600px )").matches){let e=window.scrollY>20;w.style.top=e?"0":"35px"}})),h&&h.forEach((e=>{e.addEventListener("click",(()=>{smartwoo_pro_ad("Email Template Edit","Email template editing is exclusively available in Smart Woo Pro")}))})),$&&$.addEventListener("click",(()=>{smartwoo_pro_ad("Auto Renew Service","Skip the manual work. With Smart Woo Pro, admins can instantly trigger a full subscription renewal — update invoices, mark services renewed, and send client emails — all in one click. Perfect for offline payments or fixing failed renewals.")})),y&&y.forEach((e=>{e.addEventListener("mouseover",(()=>{e.checked?e.setAttribute("title","disable"):e.setAttribute("title","enable")}))})),f&&(f.style.cursor="pointer",f.addEventListener("click",(e=>{e.preventDefault(),jQuery(f.parentElement).fadeOut()}))),_&&_.forEach((e=>{let t=null;e.addEventListener("click",(a=>{a.preventDefault(),t=window.open("","_blank"),t.location.href=e.getAttribute("href"),e.disabled=!0,e.setAttribute("title","Tab is open.");let n=()=>{t&&t.closed&&(e.disabled=!1,e.removeAttribute("title"),e.style.cursor="pointer",document.removeEventListener("scroll",n))};document.addEventListener("scroll",n),e.disabled&&(e.style.cursor="not-allowed")}))})),g&&g.addEventListener("click",(()=>{smartwooProBntAction("remind_later")})),b&&b.addEventListener("click",(()=>{smartwooProBntAction("dismiss_fornow")})),E){let e=!1,t=document.querySelector(".sw-guest-option"),a=document.querySelector(".sw-invoice-form-meta"),n=()=>{if(a.querySelectorAll("input").forEach((e=>{"is_guest_invoice"===e.name?(e.value="",e.value="no"):e.value=""})),e){E.querySelector(`option[value="${e}"]`).remove(),e=!e}t&&(t.remove(),showNotification("The origial invoice owner has been changed",7e3)),S&&(S.querySelector("#fullname").textContent="",S.querySelector("#billingAddress").textContent="",S.querySelector("#billingPhone").textContent="",S.querySelector("#companyName").textContent="",S.querySelector("#billingEmail").textContent="")},o=()=>{if(S){let e=E.value;if(!e)return;{let t=e.split("|")[0];if(t<1)return void showNotification("This user does not exist.",5e3);let a=new URL(smartwoo_admin_vars.get_user_data),n=smartWooAddSpinner("swloader");a.searchParams.append("user_id",t),a.searchParams.append("security",smartwoo_admin_vars.security),fetch(a,{method:"GET"}).then((e=>{if(!e.ok)throw showNotification(`Error: ${e.statusText}`,6e3),new Error(e.statusText);return e.json()})).then((e=>{if(e.success){let t=e.data.user;S.querySelector("#fullname").textContent=t.full_name,S.querySelector("#billingAddress").textContent=t.formated_address,S.querySelector("#billingPhone").textContent=t.billing_phone,S.querySelector("#companyName").textContent=t.billing_company,S.querySelector("#billingEmail").textContent=t.billing_email}else showNotification(e.data.message,6e3)})).catch((e=>{})).finally((()=>{smartWooRemoveSpinner(n)}))}}};E.addEventListener("change",(async t=>{let r=document.querySelector(".sw-guest-option");if(t.target.value.length&&(r&&r.value)!==t.target.value&&("smartwoo_guest"!==t.target.value&&(n(),o()),"smartwoo_guest"===t.target.value)){let t=await smartwooPromptGuestInvoiceData("Enter Guest Details");if(!t)return r?void(E.value=r.value):(n(),void(E.value=""));if(!t.billing_email.length)return showNotification("The billing email is required.",5e3),r?void(E.value=r.value):void(E.value="");let o=`${t.first_name?t.first_name+" "+t.last_name:"Guest"} (${t.billing_email})`,s=`-1|${t.billing_email}`;n();let i=document.createElement("option");i.value=s,i.text=o,i.classList.add("sw-guest-option"),E.prepend(i),E.value=i.value,e=s,a.querySelector('input[name="first_name"]').value=t.first_name,a.querySelector('input[name="last_name"]').value=t.last_name,a.querySelector('input[name="billing_address"]').value=t.billing_address,a.querySelector('input[name="billing_phone"]').value=t.billing_phone,a.querySelector('input[name="billing_company"]').value=t.billing_company,a.querySelector('input[name="billing_email"]').value=t.billing_email,a.querySelector('input[name="is_guest_invoice"]').value="yes",S&&(S.querySelector("#fullname").textContent=`${t.first_name} ${t.last_name}`,S.querySelector("#billingAddress").textContent=t.billing_address,S.querySelector("#billingPhone").textContent=t.billing_phone,S.querySelector("#companyName").textContent=t.billing_company,S.querySelector("#billingEmail").textContent=t.billing_email)}}))}if(S){Q&&smartwooInvoiceEditorItemCalculator(Q),S.querySelectorAll("[required]").forEach((e=>{let t=e.getAttribute("field-name");e.value.trim().length||e.setCustomValidity(`${t||"This field"} is required`),e.addEventListener("input",(()=>{e.value.trim().length&&e.setCustomValidity("")}))})),S.addEventListener("submit",(e=>{e.preventDefault();let t=S.querySelector('button[type="submit"]');t.setAttribute("disabled",!0);let a=smartWooAddSpinner("swloader",!0),n=document.getElementById("invoice-errors");n&&n.remove();let o=new FormData(S);o.append("security",smartwoo_admin_vars.security),fetch(smartwoo_admin_vars.ajax_url,{method:"POST",body:o}).then((e=>{if(!e.ok)throw showNotification(e.statusText,6e3),new Error(`Error: ${e.status} ${e.statusText}`);return e.json()})).then((e=>{if(e.success)showNotification(e.data.message?e.data.message:"Invoice Created",3e3),setTimeout((()=>{window.location.href=e.data.redirect_url}),3e3);else{let a=document.createElement("div");a.id="invoice-errors",a.innerHTML=e.data.htmlContent?e.data.htmlContent:e.data.message;let n=a.querySelector(".swremove-field");n&&n.addEventListener("click",(e=>e.target.parentElement.remove())),S.parentElement.insertBefore(a,S),window.scrollTo({top:0,left:0,behavior:"smooth"}),t.removeAttribute("disabled")}})).catch((e=>{t.removeAttribute("disabled")})).finally((()=>{smartWooRemoveSpinner(a)}))}))}if(L.length){let e=L[1],t=L[0],a=document.querySelector(".smartwoo-admin-invoice-billing-info"),n=document.querySelector(".smartwoo-admin-invoice-items");e.addEventListener("click",(()=>{a.classList.contains("smartwoo-hide")?(a.classList.remove("smartwoo-hide"),e.style.borderBottom="solid #000000"):(a.classList.add("smartwoo-hide"),e.style.borderBottom="none")})),t.addEventListener("click",(()=>{n.classList.contains("smartwoo-hide")?(n.classList.remove("smartwoo-hide"),t.style.borderBottom="solid #000000"):(n.classList.add("smartwoo-hide"),t.style.borderBottom="none")}))}if(k.length&&k.forEach((e=>{let t=document.querySelector("#response-div");e.addEventListener("click",(()=>{let a=t.getAttribute("data-invoice-id"),n=e.getAttribute("data-value");if(t.innerHTML="","send_payment_reminder"===n){if(!confirm("Are you sure you want to send a payment reminder email to the user?"))return}if("send_new_email"===n){if(!confirm("Are you sure you want to send a new invoice email to the user?"))return}spinner=smartWooAddSpinner("swSpinner",!0);let o=new URL(smartwoo_admin_vars.ajax_url);o.searchParams.append("action","smartwoo_admin_invoice_action"),o.searchParams.append("real_action",n),o.searchParams.append("invoice_id",a),o.searchParams.append("security",smartwoo_admin_vars.security),fetch(o,{method:"GET"}).then((e=>{if(!e.ok)throw showNotification(e.statusText,6e3),new Error(`Error: ${e.status} ${e.statusText}`);return e.json()})).then((e=>{if(e.success)if("checkout_order_pay"===n||"paymen_url"===n){let a=document.createElement("h3"),o=document.createElement("input"),r="checkout_order_pay"===n?"Checkout Link":"Payment Link";a.textContent=r,a.style.textAlign="center",o.readOnly=!0,o.id="smartwoo-invoice-links-input";let s=document.createElement("span");s.classList.add("dashicons","dashicons-admin-page"),s.setAttribute("title","copy to clipboard"),s.style.cursor="pointer",s.style.marginTop="10px",o.value=e.data.message,t.appendChild(a),t.appendChild(o),t.appendChild(s),s.addEventListener("click",(async()=>{navigator.clipboard.writeText(o.value),showNotification("Copied")}))}else t.innerHTML=e.data.message;else t.innerHTML=e.data.message,showNotification(e.data.message,6e3)})).catch((e=>{})).finally((()=>{smartWooRemoveSpinner(spinner)}))}))})),x&&q&&x.addEventListener("click",(()=>{q.classList.toggle("active")})),A){let e=A.querySelector("#swTableCheckMaster"),t=A.querySelectorAll(".sw-table-body-checkbox"),a=[],n=()=>{let e=document.querySelector(".sw-action-container");e&&e.remove()},o=()=>{a.length&&(a=[...new Set(a)],document.dispatchEvent(new CustomEvent("smartwooTableChecked",{detail:a})))};e&&e.addEventListener("change",(()=>{n(),t.forEach((t=>{isChecked=e.checked,isChecked?(t.checked=!0,a.push(t.getAttribute("data-value")),o()):(t.checked=!1,a=a.filter((e=>e!==t.getAttribute("data-value"))))}))})),t.length&&t.forEach((r=>{r.addEventListener("change",(()=>{n(),r.checked?(a.push(r.getAttribute("data-value")),o()):a=a.filter((e=>e!==r.getAttribute("data-value"))),t.length===a.length?e.checked=!0:e.checked=!1}))}))}if(C&&C.addEventListener("change",(()=>{let e=document.querySelector(".grace-period-number"),t=document.querySelector(".description-class span");C.value.length?(e.readOnly=!1,t.textContent=" after",e.value.length||(e.value=7)):(e.value="",t.textContent="",e.readOnly=!0)})),T){let e,t=document.querySelector("#product_image_id"),a=document.querySelector("#image_preview");T.addEventListener("click",(n=>{if(n.preventDefault(),"remove"===T.value)return jQuery(a).fadeOut(),setTimeout((()=>{a.innerHTML=""}),1e3),T.value="Upload",void(t.value="");e||(e=wp.media({title:"Product Image",button:{text:"Set Product Image"},multiple:!1}),e.on("select",(()=>{a.innerHTML="",t.value="";let n=e.state().get("selection").first().toJSON(),o=document.createElement("img");t.value=n.id,o.src=n.url,o.style.maxWidth="100%",a.appendChild(o),jQuery(a).fadeIn(),T.value="remove"}))),e.open()}))}if(D){let e,t=document.querySelectorAll(".sw-image-img");t.length&&t.forEach((e=>{let t=e.querySelector("span");e.addEventListener("mouseover",(()=>{t.classList.add("active")})),e.addEventListener("mouseleave",(()=>{t.classList.remove("active")})),t.addEventListener("click",(t=>{t.preventDefault(),jQuery(e).fadeOut(),setTimeout((()=>{e.remove()}),2e3)}))}));let a=document.querySelector("#sw-product-gallery-preview");D.addEventListener("click",(t=>{t.preventDefault(),e||(e=wp.media({title:"Select Images",button:{text:"Use these images"},multiple:!0}),e.on("select",(()=>{e.state().get("selection").each((e=>{let t=e.toJSON(),n=document.createElement("div"),o=document.createElement("span"),r=document.createElement("img"),s=document.createElement("input");n.classList.add("sw-image-img"),o.classList.add("dashicons","dashicons-dismiss"),r.src=t.url,s.name="product_gallery_ids[]",s.type="hidden",s.value=t.id,n.appendChild(o),n.appendChild(s),n.appendChild(r),a.appendChild(n),o.addEventListener("click",(e=>{e.preventDefault(),jQuery(n).fadeOut(),setTimeout((()=>{n.remove()}),2e3)})),n.addEventListener("mouseover",(()=>{o.classList.add("active")})),n.addEventListener("mouseleave",(()=>{o.classList.remove("active")}))}))}))),e.open()}))}if(j){let e=j.querySelectorAll("li"),t=document.querySelector(".sw-product-data-tabs-content").querySelectorAll("div"),a=()=>{t.forEach((e=>{e.classList.contains("smartwoo-hide")||e.classList.add("smartwoo-hide")})),e.forEach((e=>{e.classList.remove("active")}))};e.forEach(((e,n)=>{e.addEventListener("click",(e=>{a(),e.target.classList.add("active"),t[n].classList.remove("smartwoo-hide")}))}))}if(I&&I.addEventListener("submit",(e=>{e.preventDefault(),window.tinymce&&window.tinymce.editors.forEach((e=>e.save()));let t=document.querySelector("#response-container");t.innerHTML="";let a=smartWooAddSpinner("swloader",!0),n=new FormData(I),o=new URL(smartwoo_admin_vars.ajax_url);n.append("security",smartwoo_admin_vars.security),fetch(o,{method:"POST",body:n}).then((e=>{if(!e.ok)throw showNotification(e.statusText,6e3),new Error(`Error: ${e.status} ${e.statusText}`);return e.json()})).then((e=>{e.success?showNotification(e.data.message,3e3):showNotification(e.data.message,6e3),window.location.search.includes("tab=edit")&&e.success?window.location.reload():(t.innerHTML=e.data.htmlContent?e.data.htmlContent:e.data.message,window.scrollTo({top:0,left:0,behavior:"smooth"}),t.querySelector(".swremove-field").addEventListener("click",(e=>e.target.parentElement.remove())))})).catch((e=>{})).finally((()=>{smartWooRemoveSpinner(a)}))})),N&&N.forEach((e=>{e.addEventListener("click",(t=>{t.preventDefault(),e.parentElement.remove()}))})),B.length&&B.forEach((e=>{e.addEventListener("mouseover",(()=>{e.classList.add("active")})),e.addEventListener("mouseleave",(()=>{e.classList.remove("active")}))})),O){let e=document.querySelector(".sw-service-client-info"),t=e.querySelector(".sw-user-fullname"),a=e.querySelector(".sw-user-email"),n=e.querySelector("img"),o=smartwoo_admin_vars.default_avatar_url,r="No user selected";O.addEventListener("change",(e=>{if(!e.target.value.length)return t.textContent=r,a.textContent="",void(n.src=o);let s=smartWooAddSpinner("spinner",!1);s.style.position="absolute",s.style.left="50%",s.style.top="50%";let i=e.target.value.split("|")[0],l=new URL(smartwoo_admin_vars.get_user_data);l.searchParams.append("user_id",i),l.searchParams.append("security",smartwoo_admin_vars.security),fetch(l,{method:"GET"}).then((e=>{if(!e.ok)throw showNotification(`Error: ${e.statusText}`,6e3),new Error(e.statusText);return e.json()})).then((e=>{e.success?(t.innerHTML=`<strong>Full name</strong>: ${e.data.user.full_name}`,a.innerHTML=`<strong>Email</strong>: ${e.data.user.email}`,n.src=e.data.user.avatar_url):showNotification(e.data.message,6e3)})).catch((e=>{})).finally((()=>{smartWooRemoveSpinner(s)}))}))}if(M){M.querySelectorAll("[required]").forEach((e=>{e.addEventListener("invalid",(()=>{let t=e.getAttribute("field-name")||"This field";e.setCustomValidity(`${t} is required.`)})),e.addEventListener("input",(function(){e.setCustomValidity("")}))})),reponseDiv=document.querySelector("#response-container"),M.addEventListener("submit",(e=>{e.preventDefault(),SmartWooEditor.saveAll(),reponseDiv.innerHTML="";let t=smartWooAddSpinner("swloader",!0),a=M.querySelector('button[type="submit"]'),n=new FormData(M),o=new URL(smartwoo_admin_vars.ajax_url);n.append("security",smartwoo_admin_vars.security),a.disabled=!0,fetch(o,{method:"POST",body:n}).then((e=>{if(!e.ok)throw showNotification(`Error: ${e.statusText}`,6e3),new Error(`Error: ${e.statusText}`);return e.json()})).then((e=>{e.success?(showNotification(e.data.message,3e3),setTimeout((()=>{window.location.href=e.data.redirect_url}),3e3)):(showNotification(`Error: ${e.data.message}`,6e3),reponseDiv.innerHTML=e.data.htmlContent,window.scrollTo({top:0,left:0,behavior:"smooth"}),reponseDiv.querySelector(".swremove-field").addEventListener("click",(e=>e.target.parentElement.remove())))})).catch((e=>{})).finally((()=>{smartWooRemoveSpinner(t),a.disabled=!1}))}))}if(R&&R.addEventListener("click",(e=>{if(e.preventDefault(),!confirm("All your customizations will be lost!"))return;let t=new URL(smartwoo_admin_vars.ajax_url);t.searchParams.set("action","smartwoo_reset_fast_checkout"),t.searchParams.set("security",smartwoo_admin_vars.security),fetch(t).then((e=>{e.ok?window.location.reload():showNotification(`Error: ${e.statusText}`)}))})),W){let e=W.querySelectorAll(".smartwoo-knowledgebase-nav"),t=document.querySelectorAll(".sw-knowledgebase-content"),a=()=>{t.forEach((e=>{e.classList.contains("smartwoo-hide")||e.classList.add("smartwoo-hide")})),e.forEach((e=>{e.classList.contains("active")&&e.classList.remove("active")}))};e.forEach(((e,n)=>{e.addEventListener("click",(e=>{e.preventDefault(),a(),e.target.classList.add("active"),t[n].classList.remove("smartwoo-hide")}))}))}})),document.addEventListener("SmartWooDashboardLoaded",(()=>{let e=document.querySelectorAll(".sw-dash-content"),t=document.getElementById("dashboardBtn"),a=document.querySelector(".sw-dash-content-container");e.forEach(((e,t)=>{e.addEventListener("click",(e=>{e.target.matches(".sw-red-button")||(smartwooRemoveTable(),fetchDashboardData(t,{limit:25}))}))})),t.addEventListener("click",(()=>{smartwooRemoveTable(),jQuery(a).fadeIn().css("display","flex")}))})),document.addEventListener("smartwooTableChecked",(e=>{let t=smartwoo_admin_vars.currentScreen;"Service Orders"===t&&smartwooBulkActionForTable({options:[{value:"delete",text:"Delete"},{value:"complete",text:"Complete"}],selectedRows:e.detail,hookName:"order_table_actions"}),"Invoices"===t&&smartwooBulkActionForTable({options:[{value:"paid",text:"Paid"},{value:"unpaid",text:"Unpaid"},{value:"due",text:"Due"},{value:"cancelled",text:"Cancelled"},{value:"delete",text:"Delete"}],selectedRows:e.detail,hookName:"invoice_table_actions"}),"Service Products"===t&&smartwooBulkActionForTable({options:[{value:"publish",text:"Publish"},{value:"private",text:"Private"},{value:"pending",text:"Pending"},{value:"draft",text:"Draft"},{value:"trash",text:"Move to trash"},{value:"delete",text:"Delete"}],selectedRows:e.detail,hookName:"product_table_actions"})})),document.addEventListener("DOMContentLoaded",(function(){var e=document.getElementById("more-addi-assets"),t=document.getElementById("additionalAssets"),a=document.getElementById("isExternal");if(e&&t&&(e.addEventListener("click",(function(a){a.preventDefault();var n=document.createElement("div");n.classList.add("sw-additional-assets-field"),n.style.display="none";const o=`sw-editor-${Date.now()}-${Math.floor(1e3*Math.random())}`;n.innerHTML=`\n\t\t\t\t<hr>\n\t\t\t\t<h4>\n\t\t\t\t\tAsset type:\n\t\t\t\t\t<input type="text" name="additional_asset_types[]" placeholder="eg. water billing asset..." />\n\t\t\t\t</h4>\n\t\t\t\t<input type="text" name="additiional_asset_names[]" placeholder="Asset Name" />\n\t\t\t\t<input type="number" name="access_limits[]" class="sw-form-input" min="-1" placeholder="Limit (optional)">\n\t\t\t\t<textarea id="${o}" class="smartwoo-asset-editor-ui" name="additional_asset_values[]" placeholder="Start building: rich text, immersive audio & video playlists, stunning image galleries, custom HTML, or shortcodes."></textarea>\n                <span class="dashicons dashicons-dismiss remove-field" title="Remove this field"></span>\n            `,t.insertBefore(n,e);new SmartWooEditor(`#${o}`).init().then((()=>jQuery(n).fadeIn()))})),t.addEventListener("click",(e=>{if(e.target.classList.contains("remove-field")){e.preventDefault();let t=e.target.parentElement,a=e.target.getAttribute("data-asset-id");if(a&&confirm("This asset will be deleted from the database, click okay to continue.")){let e=smartWooAddSpinner("swloader",!0);const n=new FormData,o=smartwoo_admin_vars.ajax_url;n.set("action","smartwoo_asset_delete"),n.set("security",smartwoo_admin_vars.security),n.set("asset_id",a),fetch(o,{method:"POST",body:n,credentials:"same-origin"}).then((e=>{if(!e.ok)throw new Error(`Fetch Error: ${e.statusText}`);return e.json()})).then((e=>{e.success&&jQuery(t).fadeOut("slow",(()=>t.remove())),showNotification(e.data.message,5e3)})).catch((e=>{})).finally((()=>smartWooRemoveSpinner(e)))}else a||jQuery(t).fadeOut("slow",(()=>t.remove()))}}))),a){var n=document.getElementById("auth-token-div");a.addEventListener("change",(function(e){e.preventDefault(),"yes"===a.value?jQuery(n).fadeIn():jQuery(n).fadeOut()}))}}));